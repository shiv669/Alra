(()=>{"use strict";if("undefined"!=typeof chrome&&chrome.runtime&&chrome.runtime.getURL){const e=chrome.runtime.getURL("/");console.log("âœ… ALRA: Webpack public path set to:",e)}else console.warn("âš ï¸ ALRA: chrome.runtime.getURL not available, chunks may not load correctly");class e{constructor(e){this.modal=null,this.overlay=null,this.isVisible=!1,this.config=e,this.createModal(),this.injectStyles(),e.autoShow&&this.show()}injectStyles(){const e="alra-summary-modal-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n      @keyframes alraFadeIn {\n        from {\n          opacity: 0;\n          transform: translateY(-20px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n\n      @keyframes alraSlideIn {\n        from {\n          transform: translateX(400px);\n          opacity: 0;\n        }\n        to {\n          transform: translateX(0);\n          opacity: 1;\n        }\n      }\n\n      .alra-modal-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.3);\n        backdrop-filter: blur(4px);\n        z-index: 999998;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        animation: alraFadeIn 0.3s ease-out;\n      }\n\n      .alra-summary-modal {\n        position: fixed;\n        max-width: 500px;\n        width: 90%;\n        max-height: 80vh;\n        background: linear-gradient(135deg, rgba(255, 255, 255, 0.95) 0%, rgba(255, 255, 255, 0.98) 100%);\n        backdrop-filter: blur(20px) saturate(180%);\n        border: 1px solid rgba(255, 255, 255, 0.3);\n        border-radius: 16px;\n        box-shadow: \n          0 20px 60px rgba(0, 0, 0, 0.15),\n          0 0 0 1px rgba(255, 255, 255, 0.1) inset;\n        z-index: 999999;\n        overflow: hidden;\n        animation: alraFadeIn 0.4s cubic-bezier(0.34, 1.56, 0.64, 1);\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;\n      }\n\n      .alra-summary-modal.top-right {\n        top: 80px;\n        right: 20px;\n        animation: alraSlideIn 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);\n      }\n\n      .alra-summary-modal.center {\n        top: 50%;\n        left: 50%;\n        transform: translate(-50%, -50%);\n      }\n\n      .alra-modal-header {\n        padding: 24px 28px;\n        background: #FFFFFF;\n        border-bottom: 1px solid rgba(0, 0, 0, 0.06);\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n\n      .alra-modal-title {\n        font-size: 20px;\n        font-weight: 700;\n        color: #1F2937;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n        letter-spacing: -0.01em;\n      }\n\n      .alra-modal-close {\n        background: rgba(0, 0, 0, 0.04);\n        border: none;\n        color: #6B7280;\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        cursor: pointer;\n        font-size: 22px;\n        line-height: 1;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n\n      .alra-modal-close:hover {\n        background: rgba(0, 0, 0, 0.08);\n        color: #1F2937;\n        transform: scale(1.05);\n      }\n\n      .alra-modal-stats {\n        padding: 20px 28px;\n        background: rgba(249, 250, 251, 0.5);\n        display: flex;\n        gap: 32px;\n        flex-wrap: wrap;\n        border-bottom: 1px solid rgba(0, 0, 0, 0.06);\n      }\n\n      .alra-stat {\n        display: flex;\n        flex-direction: column;\n        gap: 6px;\n      }\n\n      .alra-stat-label {\n        font-size: 12px;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        color: #6B7280;\n        font-weight: 500;\n      }\n\n      .alra-stat-value {\n        font-size: 24px;\n        font-weight: 700;\n        color: #2563EB;\n        letter-spacing: -0.02em;\n      }\n\n      .alra-modal-content {\n        padding: 24px;\n        max-height: 50vh;\n        overflow-y: auto;\n      }\n\n      .alra-modal-content::-webkit-scrollbar {\n        width: 8px;\n      }\n\n      .alra-modal-content::-webkit-scrollbar-track {\n        background: rgba(0, 0, 0, 0.05);\n        border-radius: 4px;\n      }\n\n      .alra-modal-content::-webkit-scrollbar-thumb {\n        background: linear-gradient(135deg, #667eea, #764ba2);\n        border-radius: 4px;\n      }\n\n      .alra-summary-text {\n        font-size: 15px;\n        line-height: 1.8;\n        color: #374151;\n        margin-bottom: 24px;\n      }\n\n      .alra-key-points {\n        background: rgba(249, 250, 251, 0.8);\n        border-left: 3px solid #2563EB;\n        border-radius: 12px;\n        padding: 20px;\n        margin-bottom: 24px;\n      }\n\n      .alra-key-points-title {\n        font-size: 13px;\n        font-weight: 700;\n        color: #1F2937;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        margin-bottom: 14px;\n      }\n\n      .alra-key-point {\n        font-size: 14px;\n        line-height: 1.7;\n        color: #4B5563;\n        padding: 10px 0;\n        padding-left: 24px;\n        position: relative;\n      }\n\n      .alra-key-point::before {\n        content: \"â€¢\";\n        position: absolute;\n        left: 8px;\n        color: #2563EB;\n        font-weight: bold;\n        font-size: 18px;\n      }\n\n      .alra-keywords {\n        display: flex;\n        gap: 8px;\n        flex-wrap: wrap;\n      }\n\n      .alra-keyword-tag {\n        background: rgba(37, 99, 235, 0.08);\n        color: #2563EB;\n        padding: 8px 14px;\n        border-radius: 8px;\n        font-size: 12px;\n        font-weight: 600;\n        border: 1px solid rgba(37, 99, 235, 0.12);\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n\n      .alra-keyword-tag:hover {\n        background: rgba(37, 99, 235, 0.12);\n        transform: translateY(-1px);\n      }\n\n      .alra-modal-footer {\n        padding: 16px 24px;\n        background: rgba(247, 250, 252, 0.8);\n        border-top: 1px solid rgba(0, 0, 0, 0.08);\n        display: flex;\n        gap: 12px;\n      }\n\n      .alra-btn {\n        flex: 1;\n        padding: 10px 16px;\n        border-radius: 8px;\n        font-size: 14px;\n        font-weight: 600;\n        cursor: pointer;\n        transition: all 0.2s ease;\n        border: none;\n      }\n\n      .alra-btn-primary {\n        background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n        color: white;\n      }\n\n      .alra-btn-primary:hover {\n        transform: translateY(-2px);\n        box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n      }\n\n      .alra-btn-secondary {\n        background: white;\n        color: #667eea;\n        border: 2px solid #667eea;\n      }\n\n      .alra-btn-secondary:hover {\n        background: rgba(102, 126, 234, 0.05);\n      }\n    ",document.head.appendChild(t)}createModal(){const{summary:e,position:t="top-right"}=this.config;this.overlay=document.createElement("div"),this.overlay.className="alra-modal-overlay",this.overlay.style.display="none",this.overlay.onclick=e=>{e.target===this.overlay&&this.hide()},this.modal=document.createElement("div"),this.modal.className=`alra-summary-modal ${t}`,this.modal.style.display="none";const n=document.createElement("div");n.className="alra-modal-header",n.innerHTML='\n      <div class="alra-modal-title">\n        <span>âœ¨</span>\n        <span>AI Summary</span>\n      </div>\n    ';const o=document.createElement("button");o.className="alra-modal-close",o.innerHTML="Ã—",o.setAttribute("type","button"),o.setAttribute("aria-label","Close modal"),o.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),this.hide()}),o.onclick=e=>{e?.preventDefault(),e?.stopPropagation(),this.hide()},n.appendChild(o);const i=document.createElement("div");i.className="alra-modal-stats";const a=Math.round(100*(1-e.compressionRatio)),s=e.readingTime.original-e.readingTime.summary;i.innerHTML=`\n      <div class="alra-stat">\n        <div class="alra-stat-label">Compression</div>\n        <div class="alra-stat-value">${a}%</div>\n      </div>\n      <div class="alra-stat">\n        <div class="alra-stat-label">Time Saved</div>\n        <div class="alra-stat-value">${s}m</div>\n      </div>\n      <div class="alra-stat">\n        <div class="alra-stat-label">Confidence</div>\n        <div class="alra-stat-value">${Math.round(100*e.confidence)}%</div>\n      </div>\n    `;const r=document.createElement("div");r.className="alra-modal-content";const l=document.createElement("div");if(l.className="alra-summary-text",l.textContent=e.summaryText,e.keyPoints&&e.keyPoints.length>0){const t=document.createElement("div");t.className="alra-key-points",t.innerHTML=`\n        <div class="alra-key-points-title">Key Points</div>\n        ${e.keyPoints.map(e=>`\n          <div class="alra-key-point">${e}</div>\n        `).join("")}\n      `,r.appendChild(t)}if(r.appendChild(l),e.keywords&&e.keywords.length>0){const t=document.createElement("div");t.className="alra-keywords",e.keywords.forEach(e=>{const n=document.createElement("span");n.className="alra-keyword-tag",n.textContent=e,t.appendChild(n)}),r.appendChild(t)}const d=document.createElement("div");d.className="alra-modal-footer",d.innerHTML='\n      <button class="alra-btn alra-btn-primary" id="alra-read-full">Read Full Article</button>\n      <button class="alra-btn alra-btn-secondary" id="alra-share-summary">Share Summary</button>\n    ',this.modal.appendChild(n),this.modal.appendChild(i),this.modal.appendChild(r),this.modal.appendChild(d),d.querySelector("#alra-read-full")?.addEventListener("click",()=>{this.hide(),window.scrollTo({top:0,behavior:"smooth"})}),d.querySelector("#alra-share-summary")?.addEventListener("click",()=>{this.shareSummary()}),"center"===t?(this.overlay.appendChild(this.modal),document.body.appendChild(this.overlay)):document.body.appendChild(this.modal)}show(){this.isVisible||("center"===this.config.position&&this.overlay&&(this.overlay.style.display="flex"),this.modal&&(this.modal.style.display="block",this.modal.offsetHeight),this.isVisible=!0,console.log("âœ¨ ALRA: Summary modal shown"))}hide(){this.isVisible&&(this.overlay&&(this.overlay.style.display="none"),this.modal&&(this.modal.style.display="none"),this.isVisible=!1,console.log("ğŸ‘‹ ALRA: Summary modal hidden"))}toggle(){this.isVisible?this.hide():this.show()}destroy(){this.overlay&&this.overlay.remove(),this.modal&&this.modal.remove(),this.isVisible=!1}async shareSummary(){const e=`ğŸ“ Summary: ${this.config.summary.summaryText}\n\nGenerated by ALRA AI Browser Assistant`;if(navigator.share)try{await navigator.share({title:"Article Summary",text:e}),console.log("âœ… ALRA: Summary shared")}catch(t){this.copyToClipboard(e)}else this.copyToClipboard(e)}copyToClipboard(e){navigator.clipboard.writeText(e).then(()=>{this.showToast("âœ… Summary copied to clipboard!")}).catch(()=>{console.log("âš ï¸ ALRA: Could not copy summary")})}showToast(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 12px 20px;\n      border-radius: 8px;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n      z-index: 10000000;\n      animation: alraFadeIn 0.3s ease-out;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease-out",setTimeout(()=>t.remove(),300)},2e3)}}const t=new class{constructor(){this.metrics={timeSavedSeconds:0,articlesSummarized:0,tabsPredicted:0,clicksReduced:0}}async trackEvent(e){switch(e.type){case"time_saved":this.metrics.timeSavedSeconds+=e.value;break;case"article_summarized":this.metrics.articlesSummarized+=1;break;case"tab_predicted":this.metrics.tabsPredicted+=1;break;case"click_reduced":this.metrics.clicksReduced+=1}try{await chrome.storage.local.set({alraMetrics:this.metrics})}catch(e){console.warn("Could not save metrics:",e)}}async getMetrics(){try{const e=await chrome.storage.local.get("alraMetrics");e.alraMetrics&&(this.metrics=e.alraMetrics)}catch(e){console.warn("Could not load metrics:",e)}return{...this.metrics}}};function n(){console.log(" ALRA: Metrics tracking initialized")}function o(e){const t=[],n=e.match(/([^.!?]*[.!?]+)/g)||[],o=Math.max(1,n.length);return n.forEach((e,n)=>{const i=e.trim();if(i.length>10){const e=i.split(/\s+/).filter(e=>e.length>0),a=new Set(e.map(e=>e.toLowerCase()));t.push({text:i,wordCount:e.length,wordSet:a,position:n/o,score:0})}}),t}function i(e,t=5){const n=new Set(["the","a","an","and","or","but","in","on","at","to","for","of","with","is","are","was","were"]),o=e.toLowerCase().match(/\b\w+\b/g)||[],i=new Map;return o.forEach(e=>{!n.has(e)&&e.length>3&&i.set(e,(i.get(e)||0)+1)}),Array.from(i.entries()).sort((e,t)=>t[1]-e[1]).slice(0,t).map(([e])=>e)}function a(e){console.log(`ğŸ“„ ALRA: Generating summary for block ${e.id}...`);const t=new Map,n=new Set(["the","a","an","and","or","but","in","on","at","to","for","is","are"]);e.sentences.forEach(e=>{e.wordSet.forEach(e=>{!n.has(e)&&e.length>2&&t.set(e,(t.get(e)||0)+1)})}),e.sentences.forEach(e=>{let n=0;e.wordSet.forEach(e=>{n+=t.get(e)||0}),n/=Math.max(1,e.wordCount);const o=1+.3*(1-e.position);n*=o,e.wordCount<5?n*=.5:e.wordCount>30&&(n*=.7),e.score=n});const o=e.sentences.map((e,t)=>({...e,originalIndex:t})).sort((e,t)=>t.score-e.score).slice(0,Math.max(2,Math.ceil(.4*e.sentences.length))).sort((e,t)=>e.originalIndex-t.originalIndex),a=o.map(e=>e.text).join(" "),s=o.slice(0,3).map(e=>e.text),r=i(e.rawText,5),l=a.length/e.rawText.length,d=Math.max(1,Math.ceil(a.split(/\s+/).length/200));return{id:`summary-${e.id}`,originalText:e.rawText,summaryText:a,keyPoints:s,keywords:r,compressionRatio:Math.min(l,.9),readingTime:{original:e.estimatedReadingTime,summary:d},importance:e.importance,method:"extractive",confidence:Math.min(.95,.7+o.length/e.sentences.length*.25),sourceElement:e.element}}async function s(e){try{const t=`req-${Date.now()}-${Math.random()}`,n=await new Promise((n,o)=>{const i=e=>{e.detail.requestId===t&&(window.removeEventListener("ALRA_AI_RESPONSE",i),e.detail.success?n(e.detail.result):o(new Error(e.detail.error||"AI operation failed")))};window.addEventListener("ALRA_AI_RESPONSE",i),window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"SUMMARIZE",data:{text:e.rawText.substring(0,4e3),type:"key-points",format:"markdown",length:"medium"},requestId:t}})),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",i),o(new Error("AI operation timeout"))},1e4)});if(n){const t=n,o=t.split("\n").filter(e=>e.trim().length>0).slice(0,3),a=t.length/e.rawText.length;return console.log("âœ… ALRA: Used Chrome Summarizer API via injected bridge"),console.log("   Chrome API: Yes"),console.log(`   Words: ${e.wordCount} â†’ ${t.split(/\s+/).length} (${Math.round(100*a)}% compression)`),{id:`summary-${e.id}`,originalText:e.rawText,summaryText:t,keyPoints:o,keywords:i(e.rawText,5),compressionRatio:Math.min(a,.9),readingTime:{original:e.estimatedReadingTime,summary:Math.max(1,Math.ceil(t.split(/\s+/).length/200))},importance:e.importance,method:"chrome-api",confidence:.98,sourceElement:e.element}}return console.debug("âš ï¸ ALRA: Chrome API returned empty, using extractive fallback"),a(e)}catch(t){return console.debug("âš ï¸ ALRA: Chrome API failed, using extractive",t),a(e)}}let r=0,l=0,d=!1;function c(e){const t=document.createElement("div");t.style.cssText="\n    position: fixed;\n    bottom: 20px;\n    right: 20px;\n    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n    color: white;\n    padding: 12px 20px;\n    border-radius: 8px;\n    box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n    z-index: 10000000;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    font-size: 14px;\n    font-weight: 600;\n    animation: slideIn 0.3s ease-out;\n  ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease-out",setTimeout(()=>t.remove(),300)},3e3)}function m(){navigator.clipboard.writeText(window.location.href).then(()=>{c("âœ… Link copied to clipboard!")})}const p=new Set,u=new Set;let h=0,g={nudgesGenerated:0,nudgesShown:0,nudgesActedUpon:0,nudgesDismissed:0,avgTimeToAction:0,conversionRate:0};function y(e,t){"acted"===t?g.nudgesActedUpon++:g.nudgesDismissed++,g.conversionRate=g.nudgesShown>0?g.nudgesActedUpon/g.nudgesShown*100:0,console.log(`ğŸ“Š ALRA: Nudge ${t}: ${e}`)}async function b(e,t){if(p.has(e.id))return;if(u.has(e.trigger))return;const n=t.maxNudgesPerPage||3;if(h>=n)return;const o=function(e){const t=document.createElement("div");t.className=`alra-nudge alra-nudge-${e.priority}`,t.id=e.id,t.setAttribute("data-nudge-trigger",e.trigger),t.style.cssText="\n    position: fixed;\n    bottom: 24px;\n    right: 24px;\n    background: rgba(255, 255, 255, 0.98);\n    backdrop-filter: blur(10px);\n    border-radius: 12px;\n    padding: 18px 20px;\n    box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12), 0 0 0 1px rgba(0, 0, 0, 0.04);\n    display: flex;\n    align-items: center;\n    gap: 14px;\n    z-index: 10000;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    animation: slideIn 0.4s cubic-bezier(0.4, 0, 0.2, 1);\n    max-width: 340px;\n    border: 1px solid rgba(0, 0, 0, 0.06);\n  ";let n="#2563EB";"high"===e.priority&&(n="#EF4444"),"optional"===e.priority&&(n="#10B981"),t.style.borderLeft=`3px solid ${n}`;const o=document.createElement("div");o.style.cssText="font-size: 24px; flex-shrink: 0;",o.textContent=e.emoji;const i=document.createElement("div");i.style.cssText="flex: 1;";const a=document.createElement("div");a.style.cssText="font-size: 14px; font-weight: 500; color: #1F2937; line-height: 1.5; margin-bottom: 4px;",a.textContent=e.text,i.appendChild(a);const s=document.createElement("button");s.style.cssText=`\n    background: ${n};\n    color: white;\n    border: none;\n    border-radius: 8px;\n    padding: 8px 16px;\n    font-size: 13px;\n    font-weight: 600;\n    cursor: pointer;\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  `,s.textContent=e.actionText,s.onmouseover=()=>{s.style.transform="translateY(-1px)",s.style.boxShadow=`0 4px 12px ${n}40`},s.onmouseout=()=>{s.style.transform="translateY(0)",s.style.boxShadow="none"},s.onclick=()=>{e.action&&e.action(),y(e.id,"acted"),h--,t.remove()};const r=document.createElement("button");r.style.cssText="\n    background: rgba(0, 0, 0, 0.04);\n    border: none;\n    color: #9CA3AF;\n    cursor: pointer;\n    font-size: 18px;\n    padding: 0;\n    margin-left: 8px;\n    width: 28px;\n    height: 28px;\n    display: flex;\n    align-items: center;\n    justify-content: center;\n    flex-shrink: 0;\n    border-radius: 6px;\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n  ",r.textContent="Ã—",r.title="Dismiss",r.onmouseover=()=>{r.style.background="rgba(0, 0, 0, 0.08)",r.style.color="#374151"},r.onmouseout=()=>{r.style.background="rgba(0, 0, 0, 0.04)",r.style.color="#9CA3AF"},r.onclick=()=>{y(e.id,"dismissed"),u.add(e.trigger),h--,t.remove()},t.appendChild(o),t.appendChild(i),t.appendChild(s),t.appendChild(r);const l=document.createElement("style");return l.textContent="\n    @keyframes slideIn {\n      from {\n        transform: translateX(400px);\n        opacity: 0;\n      }\n      to {\n        transform: translateX(0);\n        opacity: 1;\n      }\n    }\n  ",document.head.appendChild(l),t}(e);document.body.appendChild(o),p.add(e.id),h++,g.nudgesShown++,console.log(`ğŸ’¡ ALRA: Showing nudge: "${e.text}" (${e.priority})`),t.autoHideAfter&&setTimeout(()=>{document.body.contains(o)&&(h--,o.remove())},1e3*t.autoHideAfter)}async function x(e,n,o){return console.log("ğŸ’¡ ALRA: Initializing Phase 5 - Contextual Nudges"),e.enabled?(setInterval(()=>{r++},1e3),window.addEventListener("scroll",()=>{l=function(){const e=window.innerHeight,t=document.documentElement.scrollHeight,n=window.scrollY;return Math.min(100,Math.round((n+e)/t*100))}()}),window.addEventListener("click",()=>{d=!0}),setInterval(async()=>{if(!function(e,t){const n=e.minTimeOnPage||30;return!(r<n)&&("article"===t&&l>50||"documentation"===t&&l>30||!("product"!==t||!d))}(e,n))return;const i=e.maxNudgesPerPage||3;if(p.size>=i)return;const a=function(e,n,o){const i=[],a=`nudge-${Date.now()}`;return n.includes("wikipedia.org")&&(o>60&&i.push({id:`${a}-1`,text:"Explore related topics",emoji:"ğŸ”—",priority:"suggested",actionText:"See Also",trigger:"deep_scroll_wikipedia",timestamp:Date.now(),action:()=>{const e=Array.from(document.querySelectorAll("h2, h3")).find(e=>e.textContent?.toLowerCase().includes("see also"));e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),console.log('âœ… ALRA: Scrolled to "See also" section'))}}),o>40&&i.push({id:`${a}-2`,text:"Save this article for later",emoji:"ğŸ“Œ",priority:"optional",actionText:"Bookmark",trigger:"mid_scroll_wikipedia",timestamp:Date.now(),action:async()=>{try{chrome.bookmarks&&(await chrome.bookmarks.create({title:document.title,url:window.location.href}),c("âœ… Bookmarked successfully!"),console.log("âœ… ALRA: Page bookmarked"))}catch(e){window.open(`javascript:(function(){window.external.AddFavorite('${window.location.href}','${document.title}');})();`)}}})),n.includes("github.com")&&i.push({id:`${a}-3`,text:"Star this repository",emoji:"â­",priority:"suggested",actionText:"Star",trigger:"github_repo",timestamp:Date.now(),action:()=>{const e=document.querySelector('button[data-test-id="star-button"], button[aria-label*="Star"]');e?(e.click(),c("â­ Starred repository!"),console.log("âœ… ALRA: Starred GitHub repository")):c("âš ï¸ Could not find star button")}}),("documentation"===e||n.includes("docs.")||n.includes("/docs/"))&&o>50&&i.push({id:`${a}-4`,text:"Copy code example",emoji:"ğŸ’»",priority:"high",actionText:"Copy Code",trigger:"docs_engagement",timestamp:Date.now(),action:async()=>{const e=document.querySelector("pre code, .highlight code, code");if(e){const n=e.textContent||"";await navigator.clipboard.writeText(n),c("âœ… Code copied to clipboard!"),console.log("âœ… ALRA: Copied code example"),await t.trackEvent({type:"click_reduced",value:3,timestamp:Date.now()})}}}),"article"===e&&(o>70&&i.push({id:`${a}-5`,text:"Share this article",emoji:"ğŸ“¤",priority:"optional",actionText:"Share",trigger:"article_completion",timestamp:Date.now(),action:async()=>{if(navigator.share)try{await navigator.share({title:document.title,text:"Check out this article!",url:window.location.href}),console.log("âœ… ALRA: Article shared")}catch(e){m()}else m()}}),r>120&&i.push({id:`${a}-6`,text:"Take a 20-second break",emoji:"ğŸ§˜",priority:"suggested",actionText:"Start Timer",trigger:"long_reading_session",timestamp:Date.now(),action:()=>{let e=20;const t=function(e){const t=document.createElement("div");return t.style.cssText="\n    position: fixed;\n    top: 50%;\n    left: 50%;\n    transform: translate(-50%, -50%);\n    background: linear-gradient(135deg, rgba(26, 32, 44, 0.95) 0%, rgba(45, 55, 72, 0.95) 100%);\n    backdrop-filter: blur(20px);\n    color: white;\n    padding: 40px 60px;\n    border-radius: 16px;\n    box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n    z-index: 10000001;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    text-align: center;\n  ",t.innerHTML=`\n    <div style="font-size: 48px; margin-bottom: 16px;">ğŸ§˜</div>\n    <div style="font-size: 64px; font-weight: 700; margin-bottom: 8px;" id="alra-timer-countdown">${e}</div>\n    <div style="font-size: 16px; color: #cbd5e0;">Take a deep breath...</div>\n  `,document.body.appendChild(t),t}(e),n=setInterval(()=>{e--,e<=0?(clearInterval(n),c("âœ… Break complete! Back to reading ğŸ“–")):function(e,t){const n=e.querySelector("#alra-timer-countdown");n&&(n.textContent=t.toString()),t<=0&&e.remove()}(t,e)},1e3);console.log("âœ… ALRA: Started 20-second break timer")}})),r>300&&i.push({id:`${a}-7`,text:"Copy page summary",emoji:"ğŸ“",priority:"high",actionText:"Copy Summary",trigger:"extended_session",timestamp:Date.now(),action:async()=>{const e=`ğŸ“ Summary of "${document.title}"\n\nRead on: ${window.location.href}\n\nYou spent ${Math.floor(r/60)} minutes on this page.`;await navigator.clipboard.writeText(e),c("âœ… Summary copied to clipboard!"),console.log("âœ… ALRA: Copied page summary")}}),i}(n,o,l);if(g.nudgesGenerated+=a.length,a.length>0){const t=await async function(e){try{if(!("ai"in window)||!("writer"in window.ai))return null;const t=await window.ai.writer.create({tone:"casual",length:"short"}),n=`Based on this content: "${e.substring(0,300)}"\nSuggest ONE specific, actionable next step (max 8 words).\nFormat: [action only, no emoji]\nExamples: "Read related article", "Save for later", "Share with team"`;return await t.write(n)}catch(e){return console.debug("âš ï¸ ALRA: Writer API unavailable, using fallback"),null}}(document.title+" "+document.body.innerText.substring(0,500));if(t){const n={id:`nudge-ai-${Date.now()}`,text:t,emoji:"âœ¨",priority:"suggested",actionText:"Try It",trigger:"writer_api",timestamp:Date.now()};await b(n,e)}else{const t=a.slice(0,i-p.size);for(const n of t)u.has(n.trigger)||(await b(n,e),await new Promise(e=>setTimeout(e,2e3)))}}},15e3),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("âœ… ALRA: Phase 5 - Contextual Nudges Active"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ğŸ’¡ Nudge system ready"),console.log(`   Min time on page: ${e.minTimeOnPage||30}s`),console.log(`   Max nudges per page: ${e.maxNudgesPerPage||3}`),console.log(`   Auto-hide after: ${e.autoHideAfter||10}s`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),g):(console.log("â­ï¸ ALRA: Nudges disabled"),g)}class f{constructor(e){this.container=null,this.mainButton=null,this.menuItems=[],this.isOpen=!1,this.options=[],this.options=e,this.createMenu(),this.injectStyles()}injectStyles(){const e="alra-floating-menu-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n      @keyframes alra-fab-pop {\n        0% { transform: scale(0); opacity: 0; }\n        50% { transform: scale(1.1); }\n        100% { transform: scale(1); opacity: 1; }\n      }\n\n      @keyframes alra-fab-slide-in {\n        from {\n          transform: translateY(20px) scale(0.8);\n          opacity: 0;\n        }\n        to {\n          transform: translateY(0) scale(1);\n          opacity: 1;\n        }\n      }\n\n      .alra-floating-container {\n        position: fixed;\n        bottom: 24px;\n        right: 24px;\n        z-index: 999999;\n        font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      }\n\n      .alra-fab-main {\n        width: 64px;\n        height: 64px;\n        border-radius: 50%;\n        background: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%);\n        box-shadow: 0 8px 24px rgba(37, 99, 235, 0.4);\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        cursor: pointer;\n        transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n        border: none;\n        position: relative;\n        animation: alra-fab-pop 0.5s cubic-bezier(0.34, 1.56, 0.64, 1);\n      }\n\n      .alra-fab-main:hover {\n        transform: scale(1.05);\n        box-shadow: 0 12px 32px rgba(37, 99, 235, 0.5);\n      }\n\n      .alra-fab-main.open {\n        background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%);\n        box-shadow: 0 8px 24px rgba(239, 68, 68, 0.4);\n      }\n\n      .alra-fab-icon {\n        font-size: 28px;\n        transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n      }\n\n      .alra-fab-main.open .alra-fab-icon {\n        transform: rotate(45deg);\n      }\n\n      .alra-fab-menu {\n        position: absolute;\n        bottom: 80px;\n        right: 0;\n        display: flex;\n        flex-direction: column;\n        gap: 12px;\n        opacity: 0;\n        pointer-events: none;\n        transition: opacity 0.3s ease;\n      }\n\n      .alra-fab-menu.open {\n        opacity: 1;\n        pointer-events: all;\n      }\n\n      .alra-fab-menu-item {\n        display: flex;\n        align-items: center;\n        gap: 12px;\n        background: rgba(255, 255, 255, 0.98);\n        backdrop-filter: blur(10px);\n        padding: 12px 20px;\n        border-radius: 50px;\n        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.12);\n        cursor: pointer;\n        border: 1px solid rgba(0, 0, 0, 0.06);\n        transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n        min-width: 200px;\n        transform-origin: right center;\n        animation: alra-fab-slide-in 0.3s cubic-bezier(0.34, 1.56, 0.64, 1);\n        position: relative;\n      }\n\n      .alra-fab-menu-item:nth-child(1) { animation-delay: 0.05s; }\n      .alra-fab-menu-item:nth-child(2) { animation-delay: 0.1s; }\n      .alra-fab-menu-item:nth-child(3) { animation-delay: 0.15s; }\n      .alra-fab-menu-item:nth-child(4) { animation-delay: 0.2s; }\n      .alra-fab-menu-item:nth-child(5) { animation-delay: 0.25s; }\n      .alra-fab-menu-item:nth-child(6) { animation-delay: 0.3s; }\n      .alra-fab-menu-item:nth-child(7) { animation-delay: 0.35s; }\n\n      .alra-fab-menu-item:hover {\n        transform: translateX(-4px) scale(1.02);\n        box-shadow: 0 6px 20px rgba(37, 99, 235, 0.2);\n        background: rgba(37, 99, 235, 0.04);\n      }\n\n      .alra-fab-menu-icon {\n        font-size: 24px;\n        width: 40px;\n        height: 40px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        background: linear-gradient(135deg, #EFF6FF 0%, #DBEAFE 100%);\n        border-radius: 50%;\n        flex-shrink: 0;\n      }\n\n      .alra-fab-menu-label {\n        font-size: 14px;\n        font-weight: 600;\n        color: #1F2937;\n        white-space: nowrap;\n      }\n\n      .alra-fab-badge {\n        position: absolute;\n        top: -4px;\n        right: -4px;\n        background: #EF4444;\n        color: white;\n        border-radius: 12px;\n        padding: 2px 6px;\n        font-size: 10px;\n        font-weight: 700;\n        min-width: 18px;\n        text-align: center;\n        box-shadow: 0 2px 8px rgba(239, 68, 68, 0.3);\n        border: 2px solid white;\n      }\n    ",document.head.appendChild(t)}createMenu(){this.container=document.createElement("div"),this.container.className="alra-floating-container",this.mainButton=document.createElement("button"),this.mainButton.className="alra-fab-main",this.mainButton.innerHTML='<div class="alra-fab-icon">âœ¨</div>',this.mainButton.onclick=()=>this.toggle();const e=document.createElement("div");e.className="alra-fab-menu",this.options.forEach(t=>{const n=document.createElement("div");n.className="alra-fab-menu-item",n.innerHTML=`\n        <div class="alra-fab-menu-icon">${t.icon}</div>\n        <div class="alra-fab-menu-label">${t.label}</div>\n        ${t.badge?`<div class="alra-fab-badge">${t.badge}</div>`:""}\n      `,n.onclick=()=>{t.action(),this.close()},this.menuItems.push(n),e.appendChild(n)}),this.container.appendChild(e),this.container.appendChild(this.mainButton),document.body.appendChild(this.container)}toggle(){this.isOpen?this.close():this.open()}open(){if(!this.container||!this.mainButton)return;this.isOpen=!0,this.mainButton.classList.add("open");const e=this.container.querySelector(".alra-fab-menu");e&&e.classList.add("open")}close(){if(!this.container||!this.mainButton)return;this.isOpen=!1,this.mainButton.classList.remove("open");const e=this.container.querySelector(".alra-fab-menu");e&&e.classList.remove("open")}updateBadge(e,t){const n=this.options.findIndex(t=>t.id===e);if(-1!==n&&this.menuItems[n]){const e=this.menuItems[n].querySelector(".alra-fab-badge");if(t>0)if(e)e.textContent=t.toString();else{const e=document.createElement("div");e.className="alra-fab-badge",e.textContent=t.toString(),this.menuItems[n].appendChild(e)}else e?.remove()}}remove(){this.container?.remove(),document.getElementById("alra-floating-menu-styles")?.remove()}}class w{constructor(){this.modal=null,this.overlay=null,this.isVisible=!1,this.createModal(),this.injectStyles()}injectStyles(){const e="alra-metrics-modal-styles";if(document.getElementById(e))return;const t=document.createElement("style");t.id=e,t.textContent="\n      .alra-metrics-overlay {\n        position: fixed;\n        top: 0;\n        left: 0;\n        width: 100%;\n        height: 100%;\n        background: rgba(0, 0, 0, 0.3);\n        backdrop-filter: blur(4px);\n        z-index: 999998;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n      }\n\n      .alra-metrics-modal {\n        position: relative;\n        width: 90%;\n        max-width: 500px;\n        background: white;\n        border-radius: 16px;\n        box-shadow: 0 20px 60px rgba(0, 0, 0, 0.15);\n        overflow: hidden;\n      }\n\n      .alra-metrics-header {\n        padding: 24px 28px;\n        background: linear-gradient(135deg, #2563EB 0%, #1E40AF 100%);\n        color: white;\n        display: flex;\n        align-items: center;\n        justify-content: space-between;\n      }\n\n      .alra-metrics-title {\n        font-size: 20px;\n        font-weight: 700;\n        display: flex;\n        align-items: center;\n        gap: 10px;\n      }\n\n      .alra-metrics-close {\n        background: rgba(255, 255, 255, 0.2);\n        border: none;\n        color: white;\n        width: 32px;\n        height: 32px;\n        border-radius: 8px;\n        cursor: pointer;\n        font-size: 22px;\n        display: flex;\n        align-items: center;\n        justify-content: center;\n        transition: all 0.2s;\n      }\n\n      .alra-metrics-close:hover {\n        background: rgba(255, 255, 255, 0.3);\n      }\n\n      .alra-metrics-content {\n        padding: 28px;\n      }\n\n      .alra-metrics-grid {\n        display: grid;\n        grid-template-columns: 1fr 1fr;\n        gap: 16px;\n        margin-bottom: 20px;\n      }\n\n      .alra-metric-card {\n        background: linear-gradient(135deg, #F9FAFB 0%, #FFFFFF 100%);\n        border: 1px solid #E5E7EB;\n        border-radius: 12px;\n        padding: 20px;\n        text-align: center;\n      }\n\n      .alra-metric-icon {\n        font-size: 32px;\n        margin-bottom: 8px;\n      }\n\n      .alra-metric-value {\n        font-size: 28px;\n        font-weight: 700;\n        color: #2563EB;\n        margin-bottom: 4px;\n      }\n\n      .alra-metric-label {\n        font-size: 12px;\n        color: #6B7280;\n        text-transform: uppercase;\n        letter-spacing: 0.05em;\n        font-weight: 600;\n      }\n    ",document.head.appendChild(t)}createModal(){this.overlay=document.createElement("div"),this.overlay.className="alra-metrics-overlay",this.overlay.style.display="none",this.overlay.onclick=e=>{e.target===this.overlay&&this.hide()},this.modal=document.createElement("div"),this.modal.className="alra-metrics-modal",this.overlay.appendChild(this.modal),document.body.appendChild(this.overlay)}async show(e){if(!this.modal)return;const t=Math.floor(e.timeSavedSeconds/60),n=Math.floor(t/60),o=n>0?`${n}h ${t%60}m`:`${t}m`;this.modal.innerHTML=`\n      <div class="alra-metrics-header">\n        <div class="alra-metrics-title">\n          <span>ğŸ“Š</span>\n          <span>Your Productivity</span>\n        </div>\n        <button class="alra-metrics-close">Ã—</button>\n      </div>\n      <div class="alra-metrics-content">\n        <div class="alra-metrics-grid">\n          <div class="alra-metric-card">\n            <div class="alra-metric-icon">â±ï¸</div>\n            <div class="alra-metric-value">${o}</div>\n            <div class="alra-metric-label">Time Saved</div>\n          </div>\n          <div class="alra-metric-card">\n            <div class="alra-metric-icon">ğŸ“–</div>\n            <div class="alra-metric-value">${e.articlesSummarized}</div>\n            <div class="alra-metric-label">Articles</div>\n          </div>\n          <div class="alra-metric-card">\n            <div class="alra-metric-icon">ğŸ¯</div>\n            <div class="alra-metric-value">${e.tabsPredicted}</div>\n            <div class="alra-metric-label">Tabs Predicted</div>\n          </div>\n          <div class="alra-metric-card">\n            <div class="alra-metric-icon">ğŸ–±ï¸</div>\n            <div class="alra-metric-value">${e.clicksReduced}</div>\n            <div class="alra-metric-label">Clicks Reduced</div>\n          </div>\n        </div>\n      </div>\n    `;const i=this.modal.querySelector(".alra-metrics-close");i&&i.addEventListener("click",()=>this.hide()),this.overlay&&(this.overlay.style.display="flex"),this.isVisible=!0}hide(){this.isVisible&&(this.overlay&&(this.overlay.style.display="none"),this.isVisible=!1)}}class v{constructor(){this.overlay=null,this.panel=null,this.isGenerating=!1,this.createPanel()}createPanel(){this.overlay=document.createElement("div"),this.overlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(4px);\n      z-index: 2147483646;\n      display: none;\n      animation: fadeIn 0.2s ease-out;\n    ",this.panel=document.createElement("div"),this.panel.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: white;\n      border-radius: 16px;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n      width: 90%;\n      max-width: 500px;\n      max-height: 80vh;\n      overflow: hidden;\n      z-index: 2147483647;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    ";const e=document.createElement("div");e.style.cssText="\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 20px 24px;\n      display: flex;\n      align-items: center;\n      justify-content: space-between;\n    ";const t=document.createElement("div");t.innerHTML='\n      <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">ğŸ’¡ Smart Suggestions</div>\n      <div style="font-size: 13px; opacity: 0.9;">AI-powered recommendations based on this page</div>\n    ';const n=document.createElement("button");n.textContent="Ã—",n.style.cssText="\n      background: rgba(255, 255, 255, 0.2);\n      border: none;\n      color: white;\n      font-size: 28px;\n      width: 32px;\n      height: 32px;\n      border-radius: 8px;\n      cursor: pointer;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      transition: all 0.2s;\n      padding: 0;\n      line-height: 1;\n    ",n.onmouseover=()=>n.style.background="rgba(255, 255, 255, 0.3)",n.onmouseout=()=>n.style.background="rgba(255, 255, 255, 0.2)",n.onclick=()=>this.hide(),e.appendChild(t),e.appendChild(n);const o=document.createElement("div");o.id="alra-nudges-content",o.style.cssText="\n      padding: 24px;\n      max-height: calc(80vh - 100px);\n      overflow-y: auto;\n    ",this.panel.appendChild(e),this.panel.appendChild(o),this.overlay.onclick=()=>this.hide();const i=document.createElement("style");i.textContent="\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes slideUp {\n        from {\n          opacity: 0;\n          transform: translate(-50%, -45%);\n        }\n        to {\n          opacity: 1;\n          transform: translate(-50%, -50%);\n        }\n      }\n    ",document.head.appendChild(i)}async show(){this.overlay&&this.panel&&(document.body.contains(this.overlay)||document.body.appendChild(this.overlay),document.body.contains(this.panel)||document.body.appendChild(this.panel),this.overlay.style.display="block",this.panel.style.display="block",await this.generateSmartSuggestions())}hide(){this.overlay&&this.panel&&(this.overlay.style.display="none",this.panel.style.display="none",document.body.contains(this.overlay)&&this.overlay.remove(),document.body.contains(this.panel)&&this.panel.remove())}async generateSmartSuggestions(){const e=document.getElementById("alra-nudges-content");if(!e||this.isGenerating)return;this.isGenerating=!0,e.innerHTML='\n      <div style="text-align: center; padding: 40px 20px; color: #6B7280;">\n        <div style="font-size: 48px; margin-bottom: 16px;">ğŸ¤–</div>\n        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Analyzing this page...</div>\n        <div style="font-size: 14px;">Gemini Nano is generating smart suggestions</div>\n        <div style="margin-top: 20px;">\n          <div style="width: 40px; height: 40px; border: 3px solid #E5E7EB; border-top-color: #667eea; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto;"></div>\n        </div>\n      </div>\n    ';const t=document.createElement("style");t.textContent="\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(t);try{const e=this.getPageContext(),t=await this.generateWithChromeAI(e);t.length>0?this.renderSuggestions(t):this.renderFallbackSuggestions(e)}catch(e){console.error("âŒ ALRA: Error generating suggestions:",e),this.renderError()}finally{this.isGenerating=!1}}getPageContext(){return`Page: ${document.title}\nURL: ${window.location.href}\nContent: ${Array.from(document.querySelectorAll("p, h1, h2, h3")).map(e=>e.textContent?.trim()).filter(e=>e&&e.length>20).slice(0,10).join(" ").substring(0,1e3)}`}async generateWithChromeAI(e){return new Promise(t=>{const n=`nudge-${Date.now()}`,o=e=>{const i=e;if(i.detail.requestId===n)if(window.removeEventListener("ALRA_AI_RESPONSE",o),i.detail.success&&i.detail.result){const e=i.detail.result,n=this.parseAISuggestions(e);t(n)}else t([])};window.addEventListener("ALRA_AI_RESPONSE",o),window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"WRITE",data:{prompt:`Based on this webpage content, suggest 4 specific, actionable next steps the user could take. Make them practical and relevant to the content.\n\n${e}\n\nFormat each suggestion as:\n[emoji] [short action text (max 6 words)]\n\nExamples:\nğŸ“š Read related research papers\nğŸ’¾ Save this for later reference\nğŸ”— Share with your team\nğŸ“ Take notes on key points`,tone:"casual",length:"short"},requestId:n}})),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",o),t([])},8e3)})}parseAISuggestions(e){const t=e.split("\n").filter(e=>e.trim()),n=[];for(let e=0;e<Math.min(t.length,4);e++){const o=t[e].trim(),i=o.match(/^([^\w\s]+)\s+(.+)$/);if(i){const t=i[1].trim(),o=i[2].trim();n.push({id:`ai-nudge-${e}`,text:o,emoji:t,category:this.categorizeNudge(o),actionText:"Do it",confidence:.9})}else o.length>5&&n.push({id:`ai-nudge-${e}`,text:o,emoji:"ğŸ’¡",category:"productivity",actionText:"Do it",confidence:.8})}return n}categorizeNudge(e){const t=e.toLowerCase();return t.includes("read")||t.includes("learn")||t.includes("study")?"learning":t.includes("break")||t.includes("rest")||t.includes("wellness")?"wellness":t.includes("navigate")||t.includes("go to")||t.includes("open")?"navigation":"productivity"}renderSuggestions(e){const t=document.getElementById("alra-nudges-content");if(!t)return;t.innerHTML='\n      <div style="margin-bottom: 20px;">\n        <div style="display: inline-flex; align-items: center; gap: 8px; background: linear-gradient(135deg, #667eea20, #764ba220); padding: 8px 16px; border-radius: 20px; font-size: 13px; color: #667eea; font-weight: 600;">\n          <span>ğŸ¤–</span>\n          <span>Generated by Gemini Nano</span>\n        </div>\n      </div>\n    ',e.forEach((e,n)=>{const o=this.createSuggestionCard(e,n);t.appendChild(o)});const n=document.createElement("div");n.style.cssText="\n      margin-top: 24px;\n      padding-top: 20px;\n      border-top: 1px solid #E5E7EB;\n      text-align: center;\n      color: #9CA3AF;\n      font-size: 13px;\n    ",n.textContent="âœ¨ These suggestions are personalized based on your current page",t.appendChild(n)}createSuggestionCard(e,t){const n=document.createElement("div");n.style.cssText=`\n      background: white;\n      border: 1.5px solid #E5E7EB;\n      border-radius: 12px;\n      padding: 16px 18px;\n      margin-bottom: 12px;\n      display: flex;\n      align-items: center;\n      gap: 14px;\n      transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n      cursor: pointer;\n      animation: slideInCard 0.3s ease-out ${.1*t}s both;\n    `;const o=document.createElement("style");o.textContent="\n      @keyframes slideInCard {\n        from {\n          opacity: 0;\n          transform: translateY(10px);\n        }\n        to {\n          opacity: 1;\n          transform: translateY(0);\n        }\n      }\n    ",document.head.appendChild(o);const i={productivity:"#667eea",learning:"#10B981",wellness:"#F59E0B",navigation:"#6366F1"}[e.category],a=document.createElement("div");a.style.cssText=`\n      font-size: 28px;\n      flex-shrink: 0;\n      width: 48px;\n      height: 48px;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      background: ${i}15;\n      border-radius: 10px;\n    `,a.textContent=e.emoji;const s=document.createElement("div");s.style.cssText="flex: 1;";const r=document.createElement("div");r.style.cssText="\n      font-size: 15px;\n      font-weight: 600;\n      color: #1F2937;\n      margin-bottom: 4px;\n    ",r.textContent=e.text;const l=document.createElement("div");l.style.cssText=`\n      font-size: 12px;\n      color: ${i};\n      text-transform: capitalize;\n      font-weight: 600;\n    `,l.textContent=e.category,s.appendChild(r),s.appendChild(l);const d=document.createElement("button");return d.style.cssText=`\n      background: ${i};\n      color: white;\n      border: none;\n      border-radius: 8px;\n      padding: 10px 20px;\n      font-size: 14px;\n      font-weight: 600;\n      cursor: pointer;\n      transition: all 0.2s;\n      flex-shrink: 0;\n    `,d.textContent=e.actionText,d.onmouseover=()=>{d.style.transform="translateY(-2px)",d.style.boxShadow=`0 4px 12px ${i}40`},d.onmouseout=()=>{d.style.transform="translateY(0)",d.style.boxShadow="none"},n.onmouseover=()=>{n.style.borderColor=i,n.style.boxShadow=`0 4px 12px ${i}20`,n.style.transform="translateY(-2px)"},n.onmouseout=()=>{n.style.borderColor="#E5E7EB",n.style.boxShadow="none",n.style.transform="translateY(0)"},d.onclick=t=>{t.stopPropagation(),e.action&&e.action(),this.showToast(`âœ… ${e.text}`)},n.appendChild(a),n.appendChild(s),n.appendChild(d),n}renderFallbackSuggestions(e){const t=window.location.href,n=[];t.includes("github.com")?n.push({id:"gh1",emoji:"â­",text:"Star this repository",category:"productivity",actionText:"Star",confidence:.9,action:()=>{const e=document.querySelector('button[data-test-id="star-button"], button[aria-label*="Star"]');e?(e.click(),this.showToast("â­ Repository starred!")):this.showToast("âš ï¸ Please star manually")}},{id:"gh2",emoji:"ğŸ“–",text:"Read the documentation",category:"learning",actionText:"Read",confidence:.8,action:()=>{const e=document.querySelector("#readme");e?(e.scrollIntoView({behavior:"smooth",block:"start"}),this.showToast("ğŸ“– Scrolled to documentation")):this.showToast("ğŸ“– Look for README section")}},{id:"gh3",emoji:"ğŸ’¾",text:"Copy clone URL",category:"productivity",actionText:"Copy",confidence:.7,action:async()=>{try{const e=document.querySelector('button[data-testid="clone-button"]');if(e)e.click(),this.showToast("ğŸ’¾ Clone dialog opened");else{const e=window.location.href.replace("github.com","github.com")+".git";await navigator.clipboard.writeText(e),this.showToast("ğŸ’¾ Clone URL copied!")}}catch(e){this.showToast("âš ï¸ Could not copy URL")}}},{id:"gh4",emoji:"ğŸ””",text:"Watch for updates",category:"productivity",actionText:"Watch",confidence:.8,action:()=>{const e=document.querySelector('button[data-test-id="watch-button"]');e?(e.click(),this.showToast("ğŸ”” Watch menu opened")):this.showToast("ğŸ”” Look for Watch button")}}):t.includes("youtube.com")?n.push({id:"yt1",emoji:"ğŸ’¾",text:"Save to Watch Later",category:"productivity",actionText:"Save",confidence:.9,action:()=>{const e=document.querySelector('button[aria-label*="Save"]');e?(e.click(),this.showToast("ğŸ’¾ Save menu opened")):this.showToast("ğŸ’¾ Look for Save button")}},{id:"yt2",emoji:"ğŸ‘",text:"Like this video",category:"productivity",actionText:"Like",confidence:.8,action:()=>{const e=document.querySelector('button[aria-label*="like this video"]');e&&"true"!==e.getAttribute("aria-pressed")?(e.click(),this.showToast("ğŸ‘ Video liked!")):e?this.showToast("ğŸ‘ Already liked!"):this.showToast("âš ï¸ Like button not found")}},{id:"yt3",emoji:"ğŸ“",text:"Open transcript",category:"learning",actionText:"Transcript",confidence:.7,action:()=>{const e=document.querySelector('button[aria-label="More actions"]');e?(e.click(),setTimeout(()=>{const e=document.querySelector('ytd-menu-service-item-renderer:has-text("transcript")');e&&e.click()},200),this.showToast("ğŸ“ Looking for transcript...")):this.showToast("ğŸ“ Check video description")}},{id:"yt4",emoji:"ğŸ”—",text:"Copy video link",category:"productivity",actionText:"Copy",confidence:.9,action:async()=>{try{await navigator.clipboard.writeText(window.location.href),this.showToast("ğŸ”— Video link copied!")}catch(e){this.showToast("âš ï¸ Could not copy link")}}}):n.push({id:"g1",emoji:"ğŸ“š",text:"Bookmark this page",category:"productivity",actionText:"Bookmark",confidence:.9,action:async()=>{try{await chrome.runtime.sendMessage({action:"ADD_BOOKMARK",url:window.location.href,title:document.title}),this.showToast("ğŸ“š Page bookmarked!")}catch(e){this.showToast("ğŸ“š Press Ctrl+D to bookmark")}}},{id:"g2",emoji:"ğŸ“¤",text:"Copy page link",category:"productivity",actionText:"Copy",confidence:.9,action:async()=>{try{await navigator.clipboard.writeText(window.location.href),this.showToast("ğŸ“¤ Link copied to clipboard!")}catch(e){this.showToast("âš ï¸ Could not copy link")}}},{id:"g3",emoji:"ğŸ“",text:"Get AI summary",category:"learning",actionText:"Summarize",confidence:.8,action:()=>{const e=document.querySelector('[data-alra-action="summary"]');e?(e.click(),this.hide(),this.showToast("ğŸ“ Generating summary...")):this.showToast("ğŸ“ Use FAB menu â†’ AI Summary")}},{id:"g4",emoji:"ğŸ”",text:"Search in this page",category:"navigation",actionText:"Search",confidence:.7,action:()=>{document.execCommand("find"),this.showToast("ğŸ” Press Ctrl+F to search")}}),this.renderSuggestions(n)}renderError(){const e=document.getElementById("alra-nudges-content");e&&(e.innerHTML='\n      <div style="text-align: center; padding: 40px 20px; color: #6B7280;">\n        <div style="font-size: 48px; margin-bottom: 16px;">âš ï¸</div>\n        <div style="font-size: 16px; font-weight: 600; margin-bottom: 8px;">Couldn\'t generate suggestions</div>\n        <div style="font-size: 14px;">Chrome\'s AI API may not be available yet</div>\n      </div>\n    ')}showToast(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 14px 20px;\n      border-radius: 10px;\n      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);\n      z-index: 2147483647;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      animation: slideIn 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease-out",setTimeout(()=>t.remove(),300)},3e3)}}class A{constructor(){this.syncEnabled=!1,this.recommendedTabs=[],this.deviceType=this.detectDeviceType(),this.initializeSync()}detectDeviceType(){const e=navigator.userAgent.toLowerCase();return window.innerWidth<=768&&!e.includes("chrome")?"mobile":/mobile|android|iphone/.test(e)?/tablet|ipad/.test(e)?"tablet":"mobile":"desktop"}async initializeSync(){const e=await chrome.storage.local.get("syncEnabled");this.syncEnabled=e.syncEnabled||!1,this.syncEnabled&&"desktop"===this.deviceType&&this.setupSyncOnClose(),console.log("ğŸ“± ALRA Device Sync: Initialized (device:",this.deviceType,", enabled:",this.syncEnabled,")")}async enableSync(){this.syncEnabled=!0,await chrome.storage.local.set({syncEnabled:!0}),await this.generateRecommendedTabs(),await this.syncToCloud(),this.showToast("âœ… Cross-device sync enabled! Your tabs will sync to Chrome when you close them."),console.log("â˜ï¸ ALRA: Sync enabled. Tabs will be saved to Chrome Sync for access on all your devices.")}async disableSync(){this.syncEnabled=!1,await chrome.storage.local.set({syncEnabled:!1}),await chrome.storage.sync.remove("alra_session"),this.showToast("âŒ Cross-device sync disabled")}setupSyncOnClose(){document.addEventListener("visibilitychange",()=>{document.hidden&&this.syncToCloud()}),window.addEventListener("beforeunload",()=>{this.syncToCloud()}),setInterval(()=>{this.syncToCloud()},12e4)}async addRecommendedTab(e,t,n,o){const i={url:e,title:t,reason:n,confidence:o,timestamp:Date.now()};this.recommendedTabs.push(i),this.recommendedTabs=this.recommendedTabs.sort((e,t)=>t.confidence-e.confidence).slice(0,5),console.log("ğŸ“± ALRA: Added recommended tab:",t)}async generateRecommendedTabs(){const e=window.location.href,t=document.title;this.recommendedTabs=[];try{const n=await this.getAIRecommendations(e,t);if(n&&n.length>0)return void n.forEach(e=>{this.addRecommendedTab(e.url,e.title,e.reason,e.confidence)})}catch(e){console.debug("âš ï¸ ALRA: AI recommendations unavailable, using heuristics")}this.generateHeuristicRecommendations(e,t)}async getAIRecommendations(e,t){return new Promise(n=>{const o=`sync-${Date.now()}`,i=t=>{const a=t;if(a.detail.requestId===o)if(window.removeEventListener("ALRA_AI_RESPONSE",i),a.detail.success&&a.detail.result){const t=this.parseAIRecommendations(a.detail.result,e);n(t)}else n([])};window.addEventListener("ALRA_AI_RESPONSE",i),window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"WRITE",data:{prompt:`Based on this webpage "${t}" at ${e}, suggest 3 related pages or topics the user might want to explore next. \n\nFormat each as:\n[URL or search term] | [Title/Topic] | [Brief reason]\n\nExamples:\nhttps://example.com/related | Related Article Title | Continues the topic\n"machine learning basics" | Search: ML Fundamentals | Good starting point\nhttps://github.com/example | GitHub Repository | Practical implementation`,tone:"professional",length:"short"},requestId:o}})),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",i),n([])},5e3)})}parseAIRecommendations(e,t){const n=e.split("\n").filter(e=>e.trim()),o=[];for(const e of n){const t=e.split("|").map(e=>e.trim());if(t.length>=3){const e=t[0].replace(/^["']|["']$/g,""),n=t[1].replace(/^["']|["']$/g,""),i=t[2].replace(/^["']|["']$/g,"");let a=e;if(e.startsWith("http")||(a=`https://www.google.com/search?q=${encodeURIComponent(e)}`),o.push({url:a,title:n,reason:i,confidence:.85,timestamp:Date.now()}),o.length>=3)break}}return o}generateHeuristicRecommendations(e,t){if(e.includes("github.com"))this.addRecommendedTab("https://github.com/trending","GitHub Trending","Discover popular projects",.8),e.match(/github\.com\/([^\/]+\/[^\/]+)/)&&this.addRecommendedTab(`${e}/issues`,"Repository Issues","Check issues and discussions",.75);else if(e.includes("wikipedia.org"))this.addRecommendedTab("https://en.wikipedia.org/wiki/Special:Random","Random Wikipedia Article","Discover something new",.7);else if(e.includes("youtube.com/watch"))this.addRecommendedTab("https://www.youtube.com","YouTube Home","Recommended videos",.8);else if(e.includes("reddit.com"))this.addRecommendedTab("https://www.reddit.com/r/popular","Popular on Reddit","Trending discussions",.75);else{const n=new URL(e).hostname;this.addRecommendedTab(`https://www.google.com/search?q=${encodeURIComponent(t)}`,`Search: ${t}`,"Find related content",.7),this.addRecommendedTab(`https://${n}`,"Homepage","Explore more from this site",.6)}}async syncToCloud(){if(!this.syncEnabled)return;0===this.recommendedTabs.length&&await this.generateRecommendedTabs();const e=await t.getMetrics(),n={deviceType:this.deviceType,recommendedTabs:this.recommendedTabs,currentPage:{url:window.location.href,title:document.title,scrollPosition:window.scrollY},metrics:e,lastSync:Date.now(),sessionId:`session-${Date.now()}`};try{await chrome.storage.sync.set({alra_session:n}),chrome.runtime.sendMessage({action:"SYNC_TABS",tabs:this.recommendedTabs.map(e=>({url:e.url,title:`[ALRA Recommended] ${e.title}`}))}),console.log("â˜ï¸ ALRA: Session synced to Chrome Storage:",n.recommendedTabs.length,"tabs"),console.log('ğŸ“± ALRA: Tabs will appear in Chrome\'s "Recent Tabs" on all your devices!')}catch(e){console.error("âŒ ALRA: Sync failed:",e)}}async checkForSyncedTabs(){try{const e=await chrome.storage.sync.get("alra_session");if(e.alra_session){const t=e.alra_session,n=(Date.now()-t.lastSync)/36e5;"desktop"===t.deviceType&&n<24&&this.showRecommendedTabsModal(t)}}catch(e){console.error("âŒ ALRA: Error checking synced tabs:",e)}}showRecommendedTabsModal(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(4px);\n      z-index: 2147483646;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      animation: fadeIn 0.3s ease-out;\n    ";const n=document.createElement("div");n.style.cssText="\n      background: white;\n      border-radius: 20px;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n      width: 90%;\n      max-width: 480px;\n      max-height: 80vh;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      animation: slideUp 0.3s cubic-bezier(0.4, 0, 0.2, 1);\n    ";const o=document.createElement("div");o.style.cssText="\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 24px;\n      text-align: center;\n    ",o.innerHTML=`\n      <div style="font-size: 48px; margin-bottom: 12px;">ğŸ“±â†’ğŸ’»</div>\n      <div style="font-size: 22px; font-weight: 700; margin-bottom: 8px;">Welcome Back!</div>\n      <div style="font-size: 14px; opacity: 0.9;">Synced from your ${e.deviceType} â€¢ ${this.timeAgo(e.lastSync)}</div>\n    `;const i=document.createElement("div");i.style.cssText="\n      padding: 24px;\n      max-height: 400px;\n      overflow-y: auto;\n    ";const a=document.createElement("div");a.style.cssText="\n      font-size: 16px;\n      font-weight: 700;\n      color: #1F2937;\n      margin-bottom: 16px;\n    ",a.textContent=`ğŸ“Œ Recommended Tabs (${e.recommendedTabs.length})`,i.appendChild(a),e.recommendedTabs.forEach((e,n)=>{const o=document.createElement("div");o.style.cssText=`\n        background: #F9FAFB;\n        border: 1.5px solid #E5E7EB;\n        border-radius: 12px;\n        padding: 16px;\n        margin-bottom: 12px;\n        cursor: pointer;\n        transition: all 0.2s;\n        animation: slideInCard 0.3s ease-out ${.1*n}s both;\n      `,o.onmouseover=()=>{o.style.borderColor="#667eea",o.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.2)",o.style.transform="translateY(-2px)"},o.onmouseout=()=>{o.style.borderColor="#E5E7EB",o.style.boxShadow="none",o.style.transform="translateY(0)"},o.innerHTML=`\n        <div style="font-size: 15px; font-weight: 600; color: #1F2937; margin-bottom: 6px;">${e.title}</div>\n        <div style="font-size: 13px; color: #6B7280; margin-bottom: 8px;">${e.reason}</div>\n        <div style="display: flex; align-items: center; gap: 8px;">\n          <div style="font-size: 11px; color: #667eea; font-weight: 600;">AI CONFIDENCE: ${Math.round(100*e.confidence)}%</div>\n          <div style="flex: 1; height: 4px; background: #E5E7EB; border-radius: 2px; overflow: hidden;">\n            <div style="height: 100%; width: ${100*e.confidence}%; background: linear-gradient(90deg, #667eea, #764ba2); transition: width 1s ease-out;"></div>\n          </div>\n        </div>\n      `,o.onclick=()=>{window.open(e.url,"_blank"),t.remove()},i.appendChild(o)}),n.appendChild(o),n.appendChild(i);const s=document.createElement("div");s.style.cssText="\n      padding: 20px 24px;\n      border-top: 1px solid #E5E7EB;\n      display: flex;\n      gap: 12px;\n    ";const r=document.createElement("button");r.textContent="Maybe Later",r.style.cssText="\n      flex: 1;\n      padding: 12px;\n      background: #F3F4F6;\n      border: none;\n      border-radius: 10px;\n      font-weight: 600;\n      color: #6B7280;\n      cursor: pointer;\n      transition: all 0.2s;\n    ",r.onmouseover=()=>r.style.background="#E5E7EB",r.onmouseout=()=>r.style.background="#F3F4F6",r.onclick=()=>t.remove();const l=document.createElement("button");l.textContent=`Open All ${e.recommendedTabs.length} Tabs`,l.style.cssText="\n      flex: 2;\n      padding: 12px;\n      background: linear-gradient(135deg, #667eea, #764ba2);\n      border: none;\n      border-radius: 10px;\n      font-weight: 600;\n      color: white;\n      cursor: pointer;\n      transition: all 0.2s;\n    ",l.onmouseover=()=>{l.style.transform="translateY(-2px)",l.style.boxShadow="0 4px 12px rgba(102, 126, 234, 0.4)"},l.onmouseout=()=>{l.style.transform="translateY(0)",l.style.boxShadow="none"},l.onclick=()=>{e.recommendedTabs.forEach(e=>{window.open(e.url,"_blank")}),t.remove(),this.showToast(`âœ… Opened ${e.recommendedTabs.length} recommended tabs!`)},s.appendChild(r),s.appendChild(l),n.appendChild(s),t.appendChild(n);const d=document.createElement("style");d.textContent="\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes slideUp {\n        from {\n          opacity: 0;\n          transform: translate(-50%, -45%);\n        }\n        to {\n          opacity: 1;\n          transform: translate(-50%, -50%);\n        }\n      }\n      @keyframes slideInCard {\n        from {\n          opacity: 0;\n          transform: translateX(-20px);\n        }\n        to {\n          opacity: 1;\n          transform: translateX(0);\n        }\n      }\n    ",document.head.appendChild(d),document.body.appendChild(t);const c=e=>{"Escape"===e.key&&(t.remove(),document.removeEventListener("keydown",c))};document.addEventListener("keydown",c)}async showSyncSettings(){const e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(4px);\n      z-index: 2147483646;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      animation: fadeIn 0.2s ease-out;\n    ";const t=document.createElement("div");t.style.cssText="\n      background: white;\n      border-radius: 16px;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n      width: 90%;\n      max-width: 420px;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ",t.innerHTML=`\n      <div style="background: linear-gradient(135deg, #667eea 0%, #764ba2 100%); color: white; padding: 24px;">\n        <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">ğŸ”„ Cross-Device Sync</div>\n        <div style="font-size: 13px; opacity: 0.9;">Sync tabs across your devices</div>\n      </div>\n      \n      <div style="padding: 24px;">\n        <div style="margin-bottom: 20px;">\n          <div style="font-size: 14px; font-weight: 600; color: #1F2937; margin-bottom: 8px;">Current Device</div>\n          <div style="background: #F3F4F6; padding: 12px; border-radius: 8px; font-size: 14px; color: #6B7280;">\n            ğŸ“± ${this.deviceType.charAt(0).toUpperCase()+this.deviceType.slice(1)}\n          </div>\n        </div>\n        \n        <div style="margin-bottom: 20px;">\n          <div style="font-size: 14px; font-weight: 600; color: #1F2937; margin-bottom: 8px;">Sync Status</div>\n          <div style="background: ${this.syncEnabled?"#ECFDF5":"#FEF2F2"}; padding: 12px; border-radius: 8px; font-size: 14px; color: ${this.syncEnabled?"#065F46":"#991B1B"};">\n            ${this.syncEnabled?"âœ… Enabled":"âŒ Disabled"}\n          </div>\n        </div>\n        \n        <div style="background: #EFF6FF; border-left: 3px solid #3B82F6; padding: 16px; border-radius: 8px; margin-bottom: 16px;">\n          <div style="font-size: 13px; color: #1E40AF; line-height: 1.5;">\n            <strong>How it works:</strong><br>\n            â€¢ When you close tabs, ALRA saves recommended next tabs to Chrome Sync<br>\n            â€¢ Open Chrome on ANY device (desktop, mobile, tablet)<br>\n            â€¢ Access synced tabs from Chrome's native "Recent Tabs" menu<br>\n            â€¢ No extension needed on other devices - uses Chrome's built-in sync!\n          </div>\n        </div>\n        \n        ${this.syncEnabled?`\n        <div style="background: #ECFDF5; border-left: 3px solid #10B981; padding: 16px; border-radius: 8px; margin-bottom: 20px;">\n          <div style="font-size: 13px; color: #065F46; line-height: 1.5;">\n            <strong>âœ… Sync is Active!</strong><br><br>\n            <strong>To verify on other devices:</strong><br>\n            1. Open Chrome on another device (phone/tablet)<br>\n            2. Tap the â‹® menu (three dots)<br>\n            3. Select "Recent tabs"<br>\n            4. Look for tabs prefixed with "[ALRA Recommended]"<br><br>\n            <em>Synced ${this.recommendedTabs.length} recommended tabs</em>\n          </div>\n        </div>\n        `:""}\n        \n        <div style="display: flex; gap: 12px;">\n          <button id="sync-close" style="flex: 1; padding: 12px; background: #F3F4F6; border: none; border-radius: 10px; font-weight: 600; color: #6B7280; cursor: pointer;">\n            Close\n          </button>\n          <button id="sync-toggle" style="flex: 2; padding: 12px; background: linear-gradient(135deg, #667eea, #764ba2); border: none; border-radius: 10px; font-weight: 600; color: white; cursor: pointer;">\n            ${this.syncEnabled?"Disable":"Enable"} Sync\n          </button>\n        </div>\n      </div>\n    `,e.onclick=t=>{t.target===e&&e.remove()},t.querySelector("#sync-close").addEventListener("click",()=>e.remove()),t.querySelector("#sync-toggle").addEventListener("click",async()=>{this.syncEnabled?await this.disableSync():await this.enableSync(),e.remove()}),e.appendChild(t),document.body.appendChild(e)}timeAgo(e){const t=Math.floor((Date.now()-e)/1e3);return t<60?"just now":t<3600?`${Math.floor(t/60)}m ago`:t<86400?`${Math.floor(t/3600)}h ago`:`${Math.floor(t/86400)}d ago`}showToast(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 14px 20px;\n      border-radius: 10px;\n      box-shadow: 0 4px 16px rgba(102, 126, 234, 0.4);\n      z-index: 2147483647;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      animation: slideIn 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease-out",setTimeout(()=>t.remove(),300)},3e3)}}class E{constructor(){this.enabled=!1,this.focusTopic="",this.focusKeywords=[],this.blockedOverlay=null,this.initializeMode()}async initializeMode(){const e=await chrome.storage.local.get("productivityMode");e.productivityMode&&(this.enabled=e.productivityMode.enabled||!1,this.focusTopic=e.productivityMode.topic||"",this.focusKeywords=e.productivityMode.keywords||[],this.enabled&&this.checkAndBlock())}async enable(){await this.setFocusTopic(),this.enabled=!0,await chrome.storage.local.set({productivityMode:{enabled:!0,topic:this.focusTopic,keywords:this.focusKeywords,startTime:Date.now()}}),this.showToast(`ğŸ¯ Productivity Mode ON: Focus on "${this.focusTopic}"`),console.log("ğŸ¯ ALRA: Productivity mode enabled. Focus:",this.focusTopic)}async disable(){this.enabled=!1,await chrome.storage.local.set({productivityMode:{enabled:!1}}),this.blockedOverlay&&(this.blockedOverlay.remove(),this.blockedOverlay=null),this.showToast("âœ… Productivity Mode OFF"),console.log("âœ… ALRA: Productivity mode disabled")}async setFocusTopic(){const e=window.location.href,t=document.title;if(e.includes("github.com")){const t=e.match(/github\.com\/([^\/]+)\/([^\/]+)/);t&&(this.focusTopic=`${t[2]} development`,this.focusKeywords=[t[1],t[2],"github","code","programming","development"])}else if(e.includes("stackoverflow.com")||e.includes("stackexchange.com"))this.focusTopic="Programming & Development",this.focusKeywords=["code","programming","development","stackoverflow","github","docs","documentation"];else if(e.includes("wikipedia.org")){const e=t.match(/^(.+?)\s*[-â€“â€”]\s*Wikipedia/);e&&(this.focusTopic=e[1],this.focusKeywords=e[1].toLowerCase().split(" "))}else e.includes("youtube.com/watch")?(this.focusTopic=t.replace(" - YouTube",""),this.focusKeywords=t.toLowerCase().split(" ").filter(e=>e.length>3)):(this.focusTopic=t,this.focusKeywords=t.toLowerCase().split(" ").filter(e=>e.length>3).slice(0,5));const n=new URL(e).hostname.replace("www.","");this.focusKeywords.push(n)}checkAndBlock(){const e=window.location.href,t=document.title.toLowerCase();this.isPageRelated(e,t)?this.blockedOverlay&&(this.blockedOverlay.remove(),this.blockedOverlay=null):this.showBlockScreen()}isPageRelated(e,t){const n=e.toLowerCase(),o=t.toLowerCase();if(n.includes("chrome://")||n.includes("chrome-extension://")||"about:blank"===n)return!0;for(const e of this.focusKeywords)if(n.includes(e.toLowerCase())||o.includes(e.toLowerCase()))return!0;const i=new URL(e).hostname.replace("www.","");for(const e of this.focusKeywords)if(i.includes(e.toLowerCase()))return!0;return!1}showBlockScreen(){if(this.blockedOverlay&&document.body.contains(this.blockedOverlay))return;this.blockedOverlay=document.createElement("div"),this.blockedOverlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: #000;\n      z-index: 2147483647;\n      display: flex;\n      flex-direction: column;\n      align-items: center;\n      justify-content: center;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ",this.blockedOverlay.innerHTML=`\n      <div style="text-align: center; max-width: 600px; padding: 40px;">\n        <div style="font-size: 120px; margin-bottom: 24px;">ğŸ¯</div>\n        <div style="font-size: 48px; font-weight: 700; color: white; margin-bottom: 16px; letter-spacing: -1px;">\n          BE PRODUCTIVE\n        </div>\n        <div style="font-size: 20px; color: rgba(255, 255, 255, 0.7); margin-bottom: 32px; line-height: 1.5;">\n          This page isn't related to your current focus:<br>\n          <strong style="color: white;">"${this.focusTopic}"</strong>\n        </div>\n        <div style="font-size: 16px; color: rgba(255, 255, 255, 0.5); margin-bottom: 40px;">\n          Stay focused on what matters. Unrelated pages are blocked.\n        </div>\n        <button id="alra-productivity-disable" style="\n          background: white;\n          color: #000;\n          border: none;\n          padding: 16px 32px;\n          border-radius: 12px;\n          font-size: 16px;\n          font-weight: 600;\n          cursor: pointer;\n          transition: all 0.2s;\n        ">\n          Disable Productivity Mode\n        </button>\n      </div>\n    `;const e=this.blockedOverlay.querySelector("#alra-productivity-disable");e&&(e.addEventListener("mouseenter",e=>{e.target.style.transform="scale(1.05)",e.target.style.boxShadow="0 8px 24px rgba(255, 255, 255, 0.3)"}),e.addEventListener("mouseleave",e=>{e.target.style.transform="scale(1)",e.target.style.boxShadow="none"}),e.addEventListener("click",()=>{this.disable()})),document.body.appendChild(this.blockedOverlay)}async showSettings(){const e=document.createElement("div");e.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.5);\n      backdrop-filter: blur(4px);\n      z-index: 2147483646;\n      display: flex;\n      align-items: center;\n      justify-content: center;\n      animation: fadeIn 0.2s ease-out;\n    ";const t=document.createElement("div");t.style.cssText="\n      background: white;\n      border-radius: 16px;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n      width: 90%;\n      max-width: 420px;\n      overflow: hidden;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    ",t.innerHTML=`\n      <div style="background: linear-gradient(135deg, #F59E0B 0%, #D97706 100%); color: white; padding: 24px;">\n        <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">ğŸ¯ Productivity Mode</div>\n        <div style="font-size: 13px; opacity: 0.9;">Block distractions, stay focused</div>\n      </div>\n      \n      <div style="padding: 24px;">\n        <div style="margin-bottom: 20px;">\n          <div style="font-size: 14px; font-weight: 600; color: #1F2937; margin-bottom: 8px;">Status</div>\n          <div style="background: ${this.enabled?"#FEF3C7":"#F3F4F6"}; padding: 12px; border-radius: 8px; font-size: 14px; color: ${this.enabled?"#92400E":"#6B7280"};">\n            ${this.enabled?`ğŸ¯ Active - Focusing on "${this.focusTopic}"`:"âŒ Disabled"}\n          </div>\n        </div>\n        \n        <div style="background: #FEF3C7; border-left: 3px solid #F59E0B; padding: 16px; border-radius: 8px; margin-bottom: 20px;">\n          <div style="font-size: 13px; color: #92400E; line-height: 1.5;">\n            <strong>How it works:</strong><br>\n            â€¢ ALRA detects your current focus topic from the active page<br>\n            â€¢ Any unrelated pages will be blocked with a "Be Productive" screen<br>\n            â€¢ You can only access pages related to your focus topic<br>\n            â€¢ Perfect for deep work sessions!\n          </div>\n        </div>\n        \n        <div style="display: flex; gap: 12px;">\n          <button id="productivity-close" style="flex: 1; padding: 12px; background: #F3F4F6; border: none; border-radius: 10px; font-weight: 600; color: #6B7280; cursor: pointer;">\n            Close\n          </button>\n          <button id="productivity-toggle" style="flex: 2; padding: 12px; background: linear-gradient(135deg, #F59E0B, #D97706); border: none; border-radius: 10px; font-weight: 600; color: white; cursor: pointer;">\n            ${this.enabled?"Disable":"Enable"} Mode\n          </button>\n        </div>\n      </div>\n    `,e.onclick=t=>{t.target===e&&e.remove()},t.querySelector("#productivity-close").addEventListener("click",()=>e.remove()),t.querySelector("#productivity-toggle").addEventListener("click",async()=>{this.enabled?await this.disable():await this.enable(),e.remove()}),e.appendChild(t),document.body.appendChild(e)}isEnabled(){return this.enabled}showToast(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      background: linear-gradient(135deg, #F59E0B, #D97706);\n      color: white;\n      padding: 14px 20px;\n      border-radius: 10px;\n      box-shadow: 0 4px 16px rgba(245, 158, 11, 0.4);\n      z-index: 2147483647;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      animation: slideIn 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease-out",setTimeout(()=>t.remove(),300)},4e3)}}class k{constructor(){this.modal=null,this.overlay=null,this.isProcessing=!1,this.createModal(),this.setupContextMenuListeners()}createModal(){this.overlay=document.createElement("div"),this.overlay.style.cssText="\n      position: fixed;\n      top: 0;\n      left: 0;\n      right: 0;\n      bottom: 0;\n      background: rgba(0, 0, 0, 0.6);\n      backdrop-filter: blur(8px);\n      z-index: 2147483646;\n      display: none;\n      animation: fadeIn 0.2s ease-out;\n    ",this.modal=document.createElement("div"),this.modal.style.cssText="\n      position: fixed;\n      top: 50%;\n      left: 50%;\n      transform: translate(-50%, -50%);\n      background: white;\n      border-radius: 20px;\n      box-shadow: 0 20px 60px rgba(0, 0, 0, 0.3);\n      width: 90%;\n      max-width: 600px;\n      max-height: 80vh;\n      overflow: hidden;\n      z-index: 2147483647;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      display: none;\n    ",this.overlay.onclick=()=>this.hide();const e=document.createElement("style");e.textContent="\n      @keyframes fadeIn {\n        from { opacity: 0; }\n        to { opacity: 1; }\n      }\n      @keyframes slideInModal {\n        from {\n          opacity: 0;\n          transform: translate(-50%, -48%) scale(0.95);\n        }\n        to {\n          opacity: 1;\n          transform: translate(-50%, -50%) scale(1);\n        }\n      }\n      @keyframes pulseGlow {\n        0%, 100% { box-shadow: 0 0 20px rgba(99, 102, 241, 0.5); }\n        50% { box-shadow: 0 0 40px rgba(99, 102, 241, 0.8); }\n      }\n    ",document.head.appendChild(e)}setupContextMenuListeners(){document.addEventListener("contextmenu",e=>{const t=e.target;"IMG"===t.tagName&&(window.alraLastClickedImage=t)})}async summarizeImage(e){let t=e;if(!t&&(t=window.alraLastClickedImage,!t)){const e=Array.from(document.querySelectorAll("img"));t=e.reduce((e,t)=>{const n=(e?.width||0)*(e?.height||0);return t.width*t.height>n?t:e},e[0])}if(t&&t.src){await this.show(),this.showLoading("Analyzing image with Gemini Nano...");try{const e=await this.imageToBlob(t),n=await this.analyzeImageWithPromptAPI(e,t.alt||"");this.showResult("ğŸ–¼ï¸ Image Analysis",n,t.src)}catch(e){console.error("âŒ ALRA: Image analysis failed:",e),this.showError("Could not analyze image. Make sure Gemini Nano is available.")}}else this.showError("No image found to analyze")}async summarizeYouTubeVideo(){if(window.location.href.includes("youtube.com/watch")){await this.show(),this.showLoading("Analyzing YouTube video with Gemini Nano...");try{const e=document.querySelector("h1.ytd-video-primary-info-renderer")?.textContent?.trim()||document.querySelector("yt-formatted-string.ytd-watch-metadata")?.textContent?.trim()||document.title,t=document.querySelector("video")?.poster||document.querySelector('meta[property="og:image"]')?.getAttribute("content")||"",n=`Video Title: ${e}\n\nDescription: ${(document.querySelector("#description-inline-expander")?.textContent?.trim()||"").substring(0,1e3)}`,o=await this.analyzeVideoWithPromptAPI(n,t);this.showResult("ğŸ¥ Video Summary",o,t)}catch(e){console.error("âŒ ALRA: Video analysis failed:",e),this.showError("Could not analyze video. Try again in a moment.")}}else this.showError("This feature only works on YouTube videos")}async proofreadText(e){if(e&&0!==e.trim().length){await this.show(),this.showLoading("Proofreading with Gemini Nano...");try{const t=await this.proofreadWithPromptAPI(e);this.showResult("ğŸ“ Proofread Text",t)}catch(e){console.error("âŒ ALRA: Proofreading failed:",e),this.showError("Could not proofread text. Make sure Gemini Nano is available.")}}else this.showError("No text selected to proofread")}async translateText(e,t="Spanish"){if(e&&0!==e.trim().length){await this.show(),this.showLoading(`Translating to ${t} with Gemini Nano...`);try{const n=await this.translateWithPromptAPI(e,t);this.showResult(`ğŸŒ Translation to ${t}`,n)}catch(e){console.error("âŒ ALRA: Translation failed:",e),this.showError("Could not translate text. Make sure Gemini Nano is available.")}}else this.showError("No text selected to translate")}async imageToBlob(e){return new Promise((t,n)=>{const o=document.createElement("canvas"),i=o.getContext("2d");if(!i)return void n(new Error("Could not create canvas context"));o.width=e.naturalWidth||e.width,o.height=e.naturalHeight||e.height;const a=new Image;a.crossOrigin="anonymous",a.onload=()=>{i.drawImage(a,0,0),o.toBlob(e=>{e?t(e):n(new Error("Could not convert image to blob"))},"image/png")},a.onerror=()=>{fetch(e.src).then(e=>e.blob()).then(t).catch(n)},a.src=e.src})}async analyzeImageWithPromptAPI(e,t){return new Promise((n,o)=>{const i=`multimodal-image-${Date.now()}`,a=e=>{const t=e;t.detail.requestId===i&&(window.removeEventListener("ALRA_AI_RESPONSE",a),t.detail.success&&t.detail.result?n(t.detail.result):o(new Error("Multimodal analysis failed")))};window.addEventListener("ALRA_AI_RESPONSE",a);const s=new FileReader;s.onloadend=()=>{const e=s.result;window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"ANALYZE_IMAGE",data:{image:e,altText:t,prompt:"Analyze this image in detail. Describe what you see, identify key elements, and provide insights about the content. If there's text in the image, read and summarize it."},requestId:i}}))},s.readAsDataURL(e),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",a),o(new Error("Image analysis timeout"))},15e3)})}async analyzeVideoWithPromptAPI(e,t){return new Promise((n,o)=>{const i=`multimodal-video-${Date.now()}`,a=e=>{const t=e;t.detail.requestId===i&&(window.removeEventListener("ALRA_AI_RESPONSE",a),t.detail.success&&t.detail.result?n(t.detail.result):o(new Error("Video analysis failed")))};window.addEventListener("ALRA_AI_RESPONSE",a),window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"ANALYZE_VIDEO",data:{context:e,thumbnail:t,prompt:"Based on this YouTube video's title and description, provide:\n1. A concise summary of what the video is about\n2. Key topics covered\n3. Who would benefit from watching this\n4. Estimated educational value\n\nKeep it clear and helpful."},requestId:i}})),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",a),o(new Error("Video analysis timeout"))},15e3)})}async proofreadWithPromptAPI(e){return new Promise((t,n)=>{const o=`proofread-${Date.now()}`,i=e=>{const a=e;a.detail.requestId===o&&(window.removeEventListener("ALRA_AI_RESPONSE",i),a.detail.success&&a.detail.result?t(a.detail.result):n(new Error("Proofreading failed")))};window.addEventListener("ALRA_AI_RESPONSE",i),window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"PROOFREAD",data:{text:e,prompt:`Proofread and correct this text. Fix grammar, spelling, punctuation, and improve clarity. Return the corrected version:\n\n"${e}"`},requestId:o}})),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",i),n(new Error("Proofreading timeout"))},1e4)})}async translateWithPromptAPI(e,t){return new Promise((n,o)=>{const i=`translate-${Date.now()}`,a=e=>{const t=e;t.detail.requestId===i&&(window.removeEventListener("ALRA_AI_RESPONSE",a),t.detail.success&&t.detail.result?n(t.detail.result):o(new Error("Translation failed")))};window.addEventListener("ALRA_AI_RESPONSE",a),window.dispatchEvent(new CustomEvent("ALRA_AI_REQUEST",{detail:{action:"TRANSLATE",data:{text:e,targetLang:t,prompt:`Translate this text to ${t}. Provide only the translation:\n\n"${e}"`},requestId:i}})),setTimeout(()=>{window.removeEventListener("ALRA_AI_RESPONSE",a),o(new Error("Translation timeout"))},1e4)})}async show(){this.overlay&&this.modal&&(document.body.contains(this.overlay)||document.body.appendChild(this.overlay),document.body.contains(this.modal)||document.body.appendChild(this.modal),this.overlay.style.display="block",this.modal.style.display="block",this.modal.style.animation="slideInModal 0.3s cubic-bezier(0.4, 0, 0.2, 1)")}hide(){this.overlay&&this.modal&&(this.overlay.style.display="none",this.modal.style.display="none",document.body.contains(this.overlay)&&this.overlay.remove(),document.body.contains(this.modal)&&this.modal.remove())}showLoading(e){if(!this.modal)return;this.modal.innerHTML=`\n      <div style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; padding: 24px; text-align: center;">\n        <div style="font-size: 20px; font-weight: 700;">ğŸ¤– Multimodal AI</div>\n      </div>\n      <div style="padding: 60px 40px; text-align: center;">\n        <div style="width: 80px; height: 80px; border: 4px solid #E5E7EB; border-top-color: #6366F1; border-radius: 50%; animation: spin 1s linear infinite; margin: 0 auto 24px;"></div>\n        <div style="font-size: 18px; font-weight: 600; color: #1F2937; margin-bottom: 8px;">${e}</div>\n        <div style="font-size: 14px; color: #6B7280;">Powered by Gemini Nano</div>\n      </div>\n    `;const t=document.createElement("style");t.textContent="\n      @keyframes spin {\n        to { transform: rotate(360deg); }\n      }\n    ",document.head.appendChild(t)}showResult(e,t,n){this.modal&&(this.modal.innerHTML=`\n      <div style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; padding: 20px 24px; display: flex; align-items: center; justify-content: space-between;">\n        <div style="font-size: 20px; font-weight: 700;">${e}</div>\n        <button id="alra-multimodal-close" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; font-size: 24px; display: flex; align-items: center; justify-content: center;">Ã—</button>\n      </div>\n      ${n?`<div style="padding: 20px; background: #F3F4F6; text-align: center;"><img src="${n}" style="max-width: 100%; max-height: 200px; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.1);"></div>`:""}\n      <div style="padding: 28px; max-height: 400px; overflow-y: auto;">\n        <div style="background: linear-gradient(135deg, #EFF6FF 0%, #F3E8FF 100%); border-left: 4px solid #6366F1; padding: 20px; border-radius: 12px; margin-bottom: 20px;">\n          <div style="font-size: 13px; color: #6366F1; font-weight: 600; margin-bottom: 8px;">âœ¨ GEMINI NANO ANALYSIS</div>\n          <div style="font-size: 15px; line-height: 1.7; color: #1F2937; white-space: pre-wrap;">${t}</div>\n        </div>\n        <div style="display: flex; gap: 12px; margin-top: 20px;">\n          <button id="alra-copy-result" style="flex: 1; padding: 12px; background: #6366F1; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s;">\n            ğŸ“‹ Copy Result\n          </button>\n          <button id="alra-share-result" style="flex: 1; padding: 12px; background: white; color: #6366F1; border: 2px solid #6366F1; border-radius: 10px; font-weight: 600; cursor: pointer; transition: all 0.2s;">\n            ğŸ”— Share\n          </button>\n        </div>\n      </div>\n    `,this.modal.querySelector("#alra-multimodal-close")?.addEventListener("click",()=>this.hide()),this.modal.querySelector("#alra-copy-result")?.addEventListener("click",async()=>{await navigator.clipboard.writeText(t),this.showToast("âœ… Copied to clipboard!")}),this.modal.querySelector("#alra-share-result")?.addEventListener("click",async()=>{navigator.share?await navigator.share({text:t,title:e}):(await navigator.clipboard.writeText(t),this.showToast("âœ… Copied to clipboard! (Share not available)"))}))}showError(e){this.modal&&(this.modal.innerHTML=`\n      <div style="background: linear-gradient(135deg, #EF4444 0%, #DC2626 100%); color: white; padding: 24px; text-align: center;">\n        <div style="font-size: 20px; font-weight: 700;">âš ï¸ Error</div>\n      </div>\n      <div style="padding: 60px 40px; text-align: center;">\n        <div style="font-size: 64px; margin-bottom: 20px;">âŒ</div>\n        <div style="font-size: 18px; font-weight: 600; color: #1F2937; margin-bottom: 12px;">${e}</div>\n        <button id="alra-error-close" style="margin-top: 20px; padding: 12px 24px; background: #EF4444; color: white; border: none; border-radius: 10px; font-weight: 600; cursor: pointer;">\n          Close\n        </button>\n      </div>\n    `,this.modal.querySelector("#alra-error-close")?.addEventListener("click",()=>this.hide()))}showToast(e){const t=document.createElement("div");t.style.cssText="\n      position: fixed;\n      bottom: 24px;\n      right: 24px;\n      background: linear-gradient(135deg, #6366F1, #8B5CF6);\n      color: white;\n      padding: 14px 20px;\n      border-radius: 10px;\n      box-shadow: 0 4px 16px rgba(99, 102, 241, 0.4);\n      z-index: 2147483647;\n      font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n      font-size: 14px;\n      font-weight: 600;\n      animation: slideIn 0.3s ease-out;\n    ",t.textContent=e,document.body.appendChild(t),setTimeout(()=>{t.style.opacity="0",t.style.transform="translateY(20px)",t.style.transition="all 0.3s ease-out",setTimeout(()=>t.remove(),300)},3e3)}async showQuickActions(){if(await this.show(),!this.modal)return;const e=window.location.href.includes("youtube.com/watch"),t=window.getSelection()?.toString().trim()||"";this.modal.innerHTML=`\n      <div style="background: linear-gradient(135deg, #6366F1 0%, #8B5CF6 100%); color: white; padding: 20px 24px; display: flex; align-items: center; justify-content: space-between;">\n        <div>\n          <div style="font-size: 20px; font-weight: 700; margin-bottom: 4px;">ğŸ¤– Multimodal AI</div>\n          <div style="font-size: 13px; opacity: 0.9;">Choose an action</div>\n        </div>\n        <button id="alra-quick-close" style="background: rgba(255, 255, 255, 0.2); border: none; color: white; width: 32px; height: 32px; border-radius: 8px; cursor: pointer; font-size: 24px;">Ã—</button>\n      </div>\n      <div style="padding: 24px;">\n        <div style="display: grid; gap: 12px;">\n          <button class="alra-action-btn" data-action="image" style="padding: 16px; background: linear-gradient(135deg, #F0F9FF 0%, #E0E7FF 100%); border: 2px solid #6366F1; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.2s;">\n            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ–¼ï¸</div>\n            <div style="font-size: 16px; font-weight: 600; color: #1F2937; margin-bottom: 4px;">Analyze Image</div>\n            <div style="font-size: 13px; color: #6B7280;">Get AI description of any image on this page</div>\n          </button>\n          \n          ${e?'\n          <button class="alra-action-btn" data-action="video" style="padding: 16px; background: linear-gradient(135deg, #FEF3C7 0%, #FDE68A 100%); border: 2px solid #F59E0B; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.2s;">\n            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ¥</div>\n            <div style="font-size: 16px; font-weight: 600; color: #1F2937; margin-bottom: 4px;">Summarize Video</div>\n            <div style="font-size: 13px; color: #6B7280;">Get AI summary of this YouTube video</div>\n          </button>\n          ':""}\n          \n          ${t?'\n          <button class="alra-action-btn" data-action="proofread" style="padding: 16px; background: linear-gradient(135deg, #ECFDF5 0%, #D1FAE5 100%); border: 2px solid #10B981; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.2s;">\n            <div style="font-size: 32px; margin-bottom: 8px;">ğŸ“</div>\n            <div style="font-size: 16px; font-weight: 600; color: #1F2937; margin-bottom: 4px;">Proofread Text</div>\n            <div style="font-size: 13px; color: #6B7280;">Fix grammar and spelling in selected text</div>\n          </button>\n          \n          <button class="alra-action-btn" data-action="translate" style="padding: 16px; background: linear-gradient(135deg, #FCE7F3 0%, #FBCFE8 100%); border: 2px solid #EC4899; border-radius: 12px; cursor: pointer; text-align: left; transition: all 0.2s;">\n            <div style="font-size: 32px; margin-bottom: 8px;">ğŸŒ</div>\n            <div style="font-size: 16px; font-weight: 600; color: #1F2937; margin-bottom: 4px;">Translate Text</div>\n            <div style="font-size: 13px; color: #6B7280;">Translate selected text to another language</div>\n          </button>\n          ':'\n          <div style="padding: 16px; background: #F3F4F6; border-radius: 12px; text-align: center; color: #6B7280; font-size: 14px;">\n            ğŸ’¡ Select text on the page to enable Proofread & Translate\n          </div>\n          '}\n        </div>\n      </div>\n    `,this.modal.querySelector("#alra-quick-close")?.addEventListener("click",()=>this.hide()),this.modal.querySelectorAll(".alra-action-btn").forEach(e=>{e.addEventListener("mouseenter",e=>{e.target.style.transform="translateY(-2px)",e.target.style.boxShadow="0 8px 24px rgba(99, 102, 241, 0.2)"}),e.addEventListener("mouseleave",e=>{e.target.style.transform="translateY(0)",e.target.style.boxShadow="none"}),e.addEventListener("click",async e=>{const n=e.currentTarget.dataset.action;this.hide(),"image"===n?await this.summarizeImage():"video"===n?await this.summarizeYouTubeVideo():"proofread"===n?await this.proofreadText(t):"translate"===n&&await this.translateText(t)})})}}let S=Date.now(),T=!1,C=null,L=null,R=null,z=null,I=null,P=null,F=null,$=!1;function M(){try{return chrome.runtime.id,!0}catch(e){return!1}}async function B(){console.log("ğŸ§  ALRA: Initializing on page:",window.location.hostname),console.log("ğŸ“„ ALRA: URL:",window.location.href),console.log("â° ALRA: Page load time:",(new Date).toLocaleTimeString());try{console.log("ğŸŒ‰ ALRA: Injecting AI Bridge..."),await new Promise(e=>{const t=document.createElement("script");t.src=chrome.runtime.getURL("injected-ai-bridge.js"),t.onload=()=>{console.log("âœ… ALRA: AI Bridge script injected"),t.remove()},t.onerror=()=>{console.log("âš ï¸ ALRA: AI Bridge script injection failed"),e(!1)},window.addEventListener("ALRA_AI_BRIDGE_READY",()=>{console.log("âœ… ALRA: AI Bridge is ready!"),e(!0)},{once:!0}),setTimeout(()=>e(!1),2e3),(document.head||document.documentElement).appendChild(t)})?console.log("âœ… ALRA: AI Bridge ready - Chrome AI APIs accessible!"):console.log("âš ï¸ ALRA: AI Bridge not available - using fallback methods"),function(){if(document.getElementById("alra-styles"))return;const e=document.createElement("style");e.id="alra-styles",e.textContent='\n    /* ALRA Container - Base styles */\n    .alra-container {\n      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, sans-serif;\n      font-size: 14px;\n      line-height: 1.5;\n      color: #333;\n      z-index: 999999;\n    }\n\n    /* ALRA Highlight - Glowing effects */\n    .alra-highlighted {\n      box-shadow: 0 0 15px rgba(66, 153, 225, 0.6) !important;\n      border-left: 4px solid #4299e1 !important;\n      padding-left: 10px !important;\n      background-color: rgba(66, 153, 225, 0.05) !important;\n      transition: all 0.3s ease;\n    }\n\n    .alra-highlighted:hover {\n      box-shadow: 0 0 25px rgba(66, 153, 225, 0.8) !important;\n      background-color: rgba(66, 153, 225, 0.1) !important;\n    }\n\n    /* ALRA Nudge - Action suggestion boxes */\n    .alra-nudge {\n      display: flex;\n      align-items: center;\n      gap: 12px;\n      padding: 16px;\n      border-radius: 8px;\n      margin: 16px 0;\n      box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);\n      cursor: pointer;\n      transition: all 0.3s ease;\n      max-width: 400px;\n    }\n\n    .alra-nudge:hover {\n      transform: translateY(-2px);\n      box-shadow: 0 6px 20px rgba(0, 0, 0, 0.15);\n    }\n\n    /* Nudge colors */\n    .alra-nudge-suggested {\n      background-color: #f0f9f5;\n      border-left: 4px solid #48bb78;\n    }\n\n    .alra-nudge-optional {\n      background-color: #f0f5ff;\n      border-left: 4px solid #4299e1;\n    }\n\n    .alra-nudge-priority {\n      background-color: #fff5e6;\n      border-left: 4px solid #ed8936;\n    }\n  ',document.head.appendChild(e),console.log("âœ… ALRA: CSS styles injected")}();let n=null;try{n=await _({action:"GET_PREFERENCES"}),console.log("âœ… ALRA: Loaded preferences",n)}catch(e){console.debug("âš ï¸ ALRA: Could not load preferences, using defaults"),n={pageOptimizationEnabled:!0,summarizationEnabled:!0,predictionsEnabled:!0,nudgesEnabled:!0,metricsTrackingEnabled:!0,privacyMode:!1}}let i=null;try{i=await _({action:"GET_AI_STATUS"}),console.log("ğŸ¤– ALRA: AI APIs available:"),console.log("   Gemini Nano: "+(i.geminiNano?"âœ…":"âŒ")),console.log("   Summarizer:  "+(i.summarizer?"âœ…":"âŒ")),console.log("   Writer:      "+(i.writer?"âœ…":"âŒ"))}catch(e){console.debug("âš ï¸ ALRA: Could not check AI API status"),i={geminiNano:!1,summarizer:!1,writer:!1}}const a=function(){const e=document.body.innerText||document.body.textContent||"",t=[];document.querySelectorAll("h1, h2, h3, h4").forEach(e=>{const n=e.innerText;n&&n.length>0&&t.push(n)});const n=Array.from(document.querySelectorAll("img")),o=Array.from(document.querySelectorAll("a")),i=document.querySelectorAll("p, article, main"),a=[];i.forEach(e=>{const t=e;(t.innerText||"").length>100&&a.push(t)});let s="other";return window.location.hostname.includes("mail")?s="email":a.length>3&&e.length>1e3?s="article":e.toLowerCase().includes("price")||e.toLowerCase().includes("buy")?s="product":(window.location.hostname.includes("twitter")||window.location.hostname.includes("reddit")||window.location.hostname.includes("facebook"))&&(s="social"),{type:s,text_content:e,headings:t,images:n,links:o,main_text_blocks:a}}();console.log("âœ… ALRA: Analyzed page, found",a.main_text_blocks.length,"content blocks"),console.log(`   Page type detected: ${a.type}`),console.log(`   Content length: ${a.text_content.length} characters`),console.log(`   Headings found: ${a.headings.length}`),console.log(`   Images found: ${a.images.length}`),console.log(`   Links found: ${a.links.length}`),n.pageOptimizationEnabled&&await async function(e){console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("ï¿½ ALRA: Initiating Phase 2 - Page Optimization"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•");try{console.log("\nğŸ“‹ ALRA: Beginning comprehensive page analysis for optimization...");const t=["ins.adsbygoogle","div[id*='ad']","div[class*='advertisement']","[data-ad-format]","[data-adslot]","iframe[src*='ads']","iframe[src*='ad.']","iframe[id*='ad']","script[src*='analytics']","img[width='1'][height='1']","img[style*='display:none']"];let n=0,o=0;const i=[];console.log("\nğŸ” ALRA: Scanning for clutter elements.."),t.forEach(e=>{try{document.querySelectorAll(e).forEach(e=>{const t=e,a=t.offsetWidth*t.offsetHeight;a>0&&(n++,o+=a,i.push(t),t.style.display="none",t.style.visibility="hidden",t.style.opacity="0",t.style.height="0",t.style.width="0",t.style.overflow="hidden",t.setAttribute("data-alra-blocked","true"))})}catch(e){}}),['aside[class*="ad"]','div[class*="sidebar"][class*="ad"]',".advertisement",".ad-container",".banner-ad"].forEach(e=>{try{document.querySelectorAll(e).forEach(e=>{const t=e;t.offsetWidth>0&&t.offsetHeight>0&&(t.style.display="none",t.setAttribute("data-alra-blocked","true"),n++)})}catch(e){}}),console.log(`   âœ… Blocked ${n} ads/clutter elements`);const a=window.innerWidth*window.innerHeight,s=(o/a*100).toFixed(1);console.log("\nğŸ“Š ALRA: Clutter Analysis Complete"),console.log(`   â€¢ Clutter elements found: ${n}`),console.log(`   â€¢ Total clutter pixels: ${o}`),console.log(`   â€¢ Clutter percentage: ${s}% of viewport`),console.log(`   â€¢ Page type detected: ${e.type}`),console.log(`   â€¢ Content blocks analyzed: ${e.main_text_blocks.length}`),console.log("\nğŸ“– ALRA: Analyzing readability factors...");const r=document.querySelectorAll("p, article, main");console.log(`   â€¢ Text elements found: ${r.length}`);const l=document.querySelectorAll("h1, h2, h3, h4, h5, h6");console.log(`   â€¢ Heading elements found: ${l.length}`);const d=document.querySelectorAll("img");console.log(`   â€¢ Image elements found: ${d.length}`);const c=a-o,m=Math.min(100,Math.round(o/a*100));console.log("\nâœ¨ ALRA: Optimization Impact Projection"),console.log(`   â€¢ Projected readability improvement: +${m}%`),console.log(`   â€¢ Content visibility would improve: +${s}%`),console.log(`   â€¢ Page would display ${c} clean content pixels`),console.log("\nğŸ¨ ALRA: Injecting optimization CSS..."),function(){if(document.getElementById("alra-optimization-status-css"))return;const e=document.createElement("style");e.id="alra-optimization-status-css",e.textContent="\n    /* ALRA Optimization Status CSS */\n    .alra-optimization-status {\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);\n      color: white;\n      padding: 12px 16px;\n      border-radius: 8px;\n      font-size: 12px;\n      font-weight: 600;\n      z-index: 10000;\n      box-shadow: 0 4px 12px rgba(102, 126, 234, 0.4);\n    }\n\n    /* Highlighted content (for Phase 2) */\n    .alra-highlighted-phase2 {\n      border-left: 3px solid #4299e1;\n      padding-left: 12px;\n      box-shadow: inset 0 0 8px rgba(66, 153, 225, 0.2);\n    }\n  ",document.head.appendChild(e),console.debug("âœ… ALRA: Optimization status CSS injected")}(),console.log("\nğŸ“¡ ALRA: Reporting optimization metrics to background..."),await _({action:"UPDATE_METRICS",data:{potentialAdsDetected:n,clutterPixels:o,clutterPercentage:parseFloat(s),readabilityImprovement:m,pageType:e.type,contentBlocksAnalyzed:e.main_text_blocks.length,headingsFound:l.length,imagesFound:d.length,optimizationEnabled:!0,optimizationPhase:2}}).catch(e=>{console.debug("âš ï¸ ALRA: Could not send optimization metrics",e)}),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("âœ… ALRA: Phase 2 page optimization analysis complete and ready!"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•\n")}catch(e){console.debug("âš ï¸ ALRA: Page optimization analysis encountered an issue:",e)}}(a),n.summarizationEnabled&&await async function(n){try{if(console.log("ğŸ“ ALRA: Starting Phase 3 - Summarization..."),"article"===n.type&&n.main_text_blocks.length>0){console.log("ğŸ“° ALRA: Article detected, initializing Phase 3 summarization");const n=await async function(n={}){const i=performance.now();console.log("ğŸ“ ALRA: Initializing Phase 3 - Inline Summarization");const a={enabled:n.enabled??!0,minBlockWordCount:n.minBlockWordCount??100,maxBlockWordCount:n.maxBlockWordCount??5e3,maxSummariesPerPage:n.maxSummariesPerPage??5,inlineDisplayMode:n.inlineDisplayMode??"badge",prioritizePageSummary:n.prioritizePageSummary??!0},r={totalBlocksAnalyzed:0,blocksSummarized:0,totalWordsOriginal:0,totalWordsSummary:0,averageCompressionRatio:0,averageReadingTimeSaved:0,chromeAPIUsed:!1,extractiveUsed:!1,totalProcessingTime:0,summariesGenerated:[]};if(!a.enabled)return console.log("â­ï¸ ALRA: Summarization disabled"),r;const l=function(){console.log("ğŸ“– ALRA: Segmenting page content into blocks...");const e=[],t=["article","main",".article",".post",".content",".entry-content",".post-content",".article-content","#mw-content-text",".mw-parser-output","#bodyContent",".story-body",".article-body",".postArticle-content",".body",".Post","[data-test-id='post-content']","[role='main']","[role='article']"];let n=0;for(const i of t)if(document.querySelectorAll(i).forEach(t=>{const i=t.innerText||"",a=i.trim().split(/\s+/).length;if(a>=100&&a<=5e3){const s={id:"block-"+n++,type:"article",element:t,rawText:i,wordCount:a,sentences:o(i),importance:75,depth:0,estimatedReadingTime:Math.max(1,Math.ceil(a/200))};e.push(s)}}),e.length>0)break;if(0===e.length){console.log("ğŸ“– ALRA: No article containers found, analyzing paragraphs...");const t=document.querySelectorAll("p"),i=[];if(t.forEach(e=>{const t=e.innerText||"",n=t.trim().split(/\s+/).length;t.length>=300&&n>=50&&i.push(e)}),i.length>=2){const t=i.map(e=>e.innerText).join("\n\n"),a=t.trim().split(/\s+/).length;if(a>=100){const s={id:"block-"+n++,type:"article",element:i[0].parentElement||i[0],rawText:t,wordCount:a,sentences:o(t),importance:70,depth:0,estimatedReadingTime:Math.max(1,Math.ceil(a/200))};e.push(s)}}}return console.log(`âœ… ALRA: Segmented ${e.length} content blocks (${e.reduce((e,t)=>e+t.wordCount,0)} words total)`),e}();if(r.totalBlocksAnalyzed=l.length,0===l.length)return console.log("âš ï¸ ALRA: No content blocks found"),r;const d=l.slice(0,a.maxSummariesPerPage);console.log(`ğŸ“Š ALRA: Summarizing ${d.length} content blocks...`);for(const n of d)try{const o=await s(n);r.summariesGenerated.push(o),r.blocksSummarized++,r.totalWordsOriginal+=n.wordCount,r.totalWordsSummary+=o.summaryText.split(/\s+/).length,"chrome-api"===o.method?r.chromeAPIUsed=!0:r.extractiveUsed=!0;const i=new e({summary:{id:o.id,summaryText:o.summaryText,keyPoints:o.keyPoints,keywords:o.keywords,compressionRatio:o.compressionRatio,readingTime:o.readingTime,confidence:o.confidence},position:"top-right",autoShow:!1});window.alraSummaryModal=i,window.alraSummaryAvailable=!0,console.log("âœ… ALRA: Summary ready (access via floating menu)");const a=Math.round((n.wordCount-o.summaryText.split(" ").length)/200*60);await t.trackEvent({type:"article_summarized",value:a,timestamp:Date.now(),details:{originalWords:n.wordCount,summaryWords:o.summaryText.split(" ").length,compressionRatio:o.compressionRatio}})}catch(e){console.debug(`âš ï¸ ALRA: Failed to summarize ${n.id}`,e)}return r.blocksSummarized>0&&(r.averageCompressionRatio=r.totalWordsSummary/r.totalWordsOriginal,r.averageReadingTimeSaved=Math.round(r.totalWordsOriginal/200-r.totalWordsSummary/200)),r.totalProcessingTime=performance.now()-i,console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("âœ… ALRA: Phase 3 - Inline Summarization Complete"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(`ğŸ“Š ALRA: Blocks analyzed: ${r.totalBlocksAnalyzed}`),console.log(`   Summarized: ${r.blocksSummarized}`),console.log(`   Words: ${r.totalWordsOriginal} â†’ ${r.totalWordsSummary}`),console.log(`   Compression: ${(100*r.averageCompressionRatio).toFixed(0)}%`),console.log(`   Time saved: ${r.averageReadingTimeSaved} minutes`),console.log("   Chrome API: "+(r.chromeAPIUsed?"Yes":"No")),console.log(`   Processing: ${r.totalProcessingTime.toFixed(0)}ms`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),r}({enabled:!0,minBlockWordCount:100,maxBlockWordCount:5e3,maxSummariesPerPage:5,inlineDisplayMode:"badge",prioritizePageSummary:!0});if(n.blocksSummarized>0)try{await _({action:"UPDATE_PHASE3_METRICS",data:{blocksAnalyzed:n.totalBlocksAnalyzed,blocksSummarized:n.blocksSummarized,totalWordsOriginal:n.totalWordsOriginal,totalWordsSummary:n.totalWordsSummary,averageCompressionRatio:n.averageCompressionRatio,readingTimeSaved:n.averageReadingTimeSaved,chromeAPIUsed:n.chromeAPIUsed,extractiveUsed:n.extractiveUsed,processingTime:n.totalProcessingTime}}),console.log("âœ… ALRA: Phase 3 metrics reported to background")}catch(e){console.debug("âš ï¸ ALRA: Could not report Phase 3 metrics",e)}}}catch(e){console.error("âŒ ALRA: Phase 3 summarization initialization failed:",e),e instanceof Error&&(console.error("   Error message:",e.message),console.error("   Error stack:",e.stack))}}(a),n.predictionsEnabled&&await async function(){try{console.log("ğŸ”® ALRA: Starting Phase 4 - Tab Predictions...");const e=await async function(e){console.log("ğŸ”® ALRA: Initializing Phase 4 - Tab Prediction");const n={enabled:e.enabled??!0,minConfidenceThreshold:e.minConfidenceThreshold??.6,maxPredictionsShown:e.maxPredictionsShown??3,highlightPredictedLinks:e.highlightPredictedLinks??!0},o={patternsDetected:0,sequencesLearned:0,predictionsGenerated:0,avgConfidence:0,predictionsShown:0,accuracy:0};if(!n.enabled)return console.log("â­ï¸ ALRA: Tab Prediction disabled"),o;const i=await async function(){const e=[],t=document.querySelectorAll("a[href]");return console.log(`ğŸ”— ALRA: Analyzing ${t.length} links on page...`),t.forEach(t=>{const n=t,o=n.href,i=n.innerText.trim();if(!o||o.startsWith("javascript:")||"#"===o||0===i.length)return;let a=0,s="";const r=n.getBoundingClientRect();r.top>=0&&r.top<=window.innerHeight&&(a+=.3,s="visible");const l=window.getComputedStyle(n);parseInt(l.fontSize)>=18&&(a+=.2,s+=s?", large":"large"),(parseInt(l.fontWeight)||400)>=600&&(a+=.15,s+=s?", bold":"bold");const d=document.title.toLowerCase(),c=i.toLowerCase();d.split(/\s+/).filter(e=>e.length>3).some(e=>c.includes(e))&&(a+=.25,s+=s?", related":"related");const m=n.parentElement?.textContent?.toLowerCase()||"";(m.includes("see also")||m.includes("main article"))&&(a+=.3,s+=s?", suggested":"suggested");const p=n.className.toLowerCase();(p.includes("featured")||p.includes("recommended")||p.includes("related"))&&(a+=.2,s+=s?", featured":"featured"),a>=.4&&e.push({element:n,url:o,text:i.substring(0,100),confidence:Math.min(a,1),reason:s})}),e.sort((e,t)=>t.confidence-e.confidence),console.log(`âœ… ALRA: Found ${e.length} high-confidence link predictions`),e}();if(o.predictionsGenerated=i.length,i.length>0){const e=i.reduce((e,t)=>e+t.confidence,0)/i.length;o.avgConfidence=e,o.patternsDetected=i.length}return n.highlightPredictedLinks&&i.filter(e=>e.confidence>=n.minConfidenceThreshold).slice(0,n.maxPredictionsShown).forEach((e,n)=>{!function(e,n){const{element:o,confidence:i,reason:a}=e;if(o.classList.contains("alra-predicted-link"))return;const s=o.innerText.trim();o.classList.add("alra-predicted-link"),o.setAttribute("data-prediction-rank",n.toString()),o.setAttribute("data-confidence",(100*i).toFixed(0)),o.setAttribute("data-reason",a),o.style.cssText+="\n    position: relative;\n    background: rgba(37, 99, 235, 0.04);\n    border: 1.5px solid rgba(37, 99, 235, 0.15);\n    padding: 6px 12px !important;\n    border-radius: 8px;\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n    margin: 2px;\n    display: inline-block;\n  ";const r=document.createElement("span");r.className="alra-prediction-badge",r.style.cssText="\n    position: absolute;\n    top: -8px;\n    right: -8px;\n    background: #2563EB;\n    color: white;\n    border-radius: 10px;\n    padding: 2px 7px;\n    font-size: 10px;\n    font-weight: 700;\n    z-index: 10000;\n    box-shadow: 0 2px 8px rgba(37, 99, 235, 0.25);\n    border: 2px solid white;\n    pointer-events: none;\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n    letter-spacing: 0.02em;\n  ",r.textContent=`${n}`,r.title=`Prediction #${n}: ${(100*i).toFixed(0)}% confidence - ${a}`;const l=document.createElement("div");l.className="alra-prediction-tooltip",l.style.cssText="\n    position: absolute;\n    bottom: calc(100% + 10px);\n    left: 50%;\n    transform: translateX(-50%) scale(0.95);\n    background: rgba(31, 41, 55, 0.96);\n    backdrop-filter: blur(10px);\n    color: white;\n    padding: 8px 12px;\n    border-radius: 8px;\n    font-size: 11px;\n    font-weight: 500;\n    white-space: nowrap;\n    z-index: 10001;\n    box-shadow: 0 4px 16px rgba(0, 0, 0, 0.2);\n    opacity: 0;\n    pointer-events: none;\n    transition: all 0.2s cubic-bezier(0.4, 0, 0.2, 1);\n    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;\n  ",l.innerHTML=`\n    <div style="display: flex; align-items: center; gap: 8px;">\n      <span style="color: #60A5FA;">ğŸ¯ ${(100*i).toFixed(0)}%</span>\n      <span style="color: #9CA3AF;">Â·</span>\n      <span style="color: #E5E7EB; font-weight: 400;">${a}</span>\n    </div>\n  `;const d=document.createElement("div");d.style.cssText="\n    position: absolute;\n    top: 100%;\n    left: 50%;\n    transform: translateX(-50%);\n    width: 0;\n    height: 0;\n    border-left: 6px solid transparent;\n    border-right: 6px solid transparent;\n    border-top: 6px solid rgba(26, 32, 44, 0.95);\n  ",l.appendChild(d);const c=document.createElement("span");c.className="alra-link-wrapper",c.style.cssText="\n    position: relative;\n    display: inline-block;\n  ",o.parentElement&&(o.parentElement.insertBefore(c,o),c.appendChild(o),c.appendChild(r),c.appendChild(l)),o.addEventListener("click",async()=>{await t.trackEvent({type:"tab_predicted",value:1,timestamp:Date.now(),details:{confidence:i,reason:a,rank:n,url:e.url}})}),o.addEventListener("mouseenter",()=>{o.style.transform="translateY(-1px)",o.style.background="rgba(37, 99, 235, 0.08)",o.style.borderColor="rgba(37, 99, 235, 0.3)",o.style.boxShadow="0 4px 12px rgba(37, 99, 235, 0.15)",r.style.transform="scale(1.05)",l.style.opacity="1",l.style.transform="translateX(-50%) scale(1)"}),o.addEventListener("mouseleave",()=>{o.style.transform="translateY(0)",o.style.background="rgba(37, 99, 235, 0.04)",o.style.borderColor="rgba(37, 99, 235, 0.15)",o.style.boxShadow="none",r.style.transform="scale(1)",l.style.opacity="0",l.style.transform="translateX(-50%) scale(0.95)"}),console.log(`ğŸ¯ ALRA: Highlighted link #${n}: "${s.substring(0,50)}" (${(100*i).toFixed(0)}%)`)}(e,n+1),o.predictionsShown++}),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log("âœ… ALRA: Phase 4 - Tab Prediction Complete"),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),console.log(`ğŸ”® Predictions generated: ${o.predictionsGenerated}`),console.log(`   Shown: ${o.predictionsShown}`),console.log(`   Avg confidence: ${(100*o.avgConfidence).toFixed(0)}%`),console.log(`   Patterns detected: ${o.patternsDetected}`),console.log("â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•â•"),o}({enabled:!0,minPatternOccurrences:2,minConfidenceThreshold:.3,maxPredictionsShown:3,historyLookbackDays:7,updateIntervalMs:3e4,showInPopup:!0,highlightPredictedLinks:!0});if(e.predictionsGenerated>0)try{await _({action:"UPDATE_PHASE4_METRICS",data:{patternsDetected:e.patternsDetected,sequencesLearned:e.sequencesLearned,predictionsGenerated:e.predictionsGenerated,avgConfidence:e.avgConfidence,predictionsShown:e.predictionsShown,accuracy:e.accuracy}}),console.log("âœ… ALRA: Phase 4 metrics reported to background")}catch(e){console.debug("âš ï¸ ALRA: Could not report Phase 4 metrics",e)}}catch(e){console.error("âŒ ALRA: Phase 4 prediction initialization failed:",e),e instanceof Error&&(console.error("   Error message:",e.message),console.error("   Error stack:",e.stack))}}(),n.nudgesEnabled&&await async function(e){console.log("ğŸ’¡ ALRA: Phase 5 - Nudges (Available via FAB menu only)");const t={enabled:!1,minTimeOnPage:60,maxNudgesPerPage:2,autoHideAfter:10,position:"bottom-right"};try{await x(t,e.type,window.location.href)}catch(e){console.error("âš ï¸ ALRA: Nudge initialization failed",e)}}(a),n.metricsTrackingEnabled&&(document.addEventListener("scroll",()=>{T||(T=!0,console.log("âœ… ALRA: User started reading"))},{once:!0}),window.addEventListener("beforeunload",()=>{const e=Math.floor((Date.now()-S)/1e3);console.log("ğŸ“Š ALRA: User spent",e,"seconds on this page")})),function(){console.log("ğŸ‘ï¸ ALRA: Setting up interaction tracking...");let e=0,t=0,n=0,o=0;document.addEventListener("click",t=>{e++;const n=t.target;M()&&console.debug(`ğŸ“ ALRA: User clicked on: ${n.tagName}`,n.className)},!0),window.addEventListener("scroll",()=>{t++},{passive:!0}),document.addEventListener("mouseup",()=>{const e=window.getSelection()?.toString();e&&e.length>0&&(n++,console.log(`ğŸ“– ALRA: User selected text (${n} selections)`,e.substring(0,50)+"..."))}),document.addEventListener("mousemove",()=>{o++},{passive:!0});const i=setInterval(()=>{if(!M())return void clearInterval(i);const a=Math.floor((Date.now()-S)/1e3);chrome.runtime.sendMessage({action:"UPDATE_METRICS",data:{timeOnPageSeconds:a,userInteractions:e,scrollEvents:t,textSelections:n,mouseEvents:o,pageUrl:window.location.href,pageTitle:document.title}},e=>{chrome.runtime.lastError?clearInterval(i):e?.success&&console.debug("âœ… ALRA: Metrics updated in background script")})},3e4);window.addEventListener("beforeunload",()=>{if(!M())return;const o=Math.floor((Date.now()-S)/1e3);console.debug(`ğŸ“Š ALRA: Page session ended. Time: ${o}s, Interactions: ${e}, Scrolls: ${t}, Selections: ${n}`);try{chrome.runtime.sendMessage({action:"UPDATE_METRICS",data:{timeOnPageSeconds:o,userInteractions:e,scrollEvents:t,textSelections:n,totalEngagement:e+t+n,pageUrl:window.location.href,pageTitle:document.title,sessionEnded:!0}})}catch(e){}}),console.log("âœ… ALRA: Interaction tracking initialized")}(),console.log("âœ¨ ALRA: Fully initialized on this page!"),console.log(`ğŸ¯ ALRA: Available features: Optimization(${n.pageOptimizationEnabled}), Summarization(${n.summarizationEnabled}), Predictions(${n.predictionsEnabled}), Nudges(${n.nudgesEnabled}), Tracking(${n.metricsTrackingEnabled})`)}catch(e){console.debug("âš ï¸ ALRA: Error initializing (non-critical):",e)}}function _(e){return new Promise((t,n)=>{if(M())try{const o=setTimeout(()=>{n(new Error("Message response timeout - port may have closed"))},5e3);chrome.runtime.sendMessage(e,e=>{clearTimeout(o),chrome.runtime.lastError?n(chrome.runtime.lastError):t(e)})}catch(e){n(e)}else n(new Error("Extension context invalidated"))})}function N(){if(C)return;window.alraSummaryModal&&(L=window.alraSummaryModal,$=!0),R=new w,z=new v,I=new A,P=new E,F=new k,C=new f([{id:"summary",label:"AI Summary",icon:"âœ¨",action:()=>{L?L.show():alert("â³ Summary is being generated...\nPlease wait a moment and try again!")},badge:$?1:0},{id:"multimodal",label:"Multimodal AI",icon:"ğŸ¤–",action:async()=>{F&&await F.showQuickActions()}},{id:"metrics",label:"Productivity Stats",icon:"ğŸ“Š",action:async()=>{const e=await t.getMetrics();R&&R.show(e)}},{id:"nudges",label:"Smart Nudges",icon:"ğŸ’¡",action:async()=>{z&&await z.show()},badge:0},{id:"productivity",label:"Productivity Mode",icon:"ğŸ¯",action:async()=>{P&&await P.showSettings()}},{id:"sync",label:"Device Sync",icon:"ğŸ”„",action:async()=>{I&&await I.showSyncSettings()}},{id:"settings",label:"Extension Info",icon:"âš™ï¸",action:()=>{alert("ğŸ’¡ ALRA - AI Browser Assistant\n\nClick the extension icon in your toolbar for detailed stats!\n\nâœ¨ AI Summary\nğŸ¤– Multimodal AI (Image, Video, Text)\nğŸ“Š Productivity Stats\nğŸ’¡ Smart Nudges\nğŸ¯ Productivity Mode\nğŸ”„ Device Sync")}}]),console.log("ğŸ¯ ALRA: Floating menu initialized");const e=setInterval(()=>{window.alraSummaryAvailable&&!$&&($=!0,L=window.alraSummaryModal,C?.updateBadge("summary",1),console.log("âœ… ALRA: Summary now available in menu!"),clearInterval(e))},1e3);setTimeout(()=>clearInterval(e),3e4)}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{B(),n(),setTimeout(N,1e3)}):(B(),n(),setTimeout(N,1e3)),chrome.runtime.onMessage.addListener((e,t,n)=>{if("PAGE_LOADED"===e.action)return console.log("âœ… ALRA: Page loaded, optimizing..."),B().then(()=>n({success:!0})),!0})})();